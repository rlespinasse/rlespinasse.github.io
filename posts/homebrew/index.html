<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Homebrew | Utilisez un package manager sous macOS"><meta itemprop=description content="Votre société ou votre client vient de vous confier un macbook pour travailler, il ne vous reste plus qu'à installer tout un ensemble de programmes pour commencer.
Sous linux, vous auriez un gestionnaire de formulas qui ferait bien l'affaire pour aller plus vite. Mais sous macOS, pas de apt-get, pas de yum, vous voilà parti pour installer tout cela à la main.
Pas de crainte, des gestionnaires de formulas existent aussi pour macOS comme Homebrew (ou MacPorts)"><meta itemprop=datePublished content="2017-02-28T10:42:00+01:00"><meta itemprop=dateModified content="2017-02-28T10:42:00+01:00"><meta itemprop=wordCount content="2632"><meta itemprop=image content="https://www.romainlespinasse.dev/img/posts/homebrew/featured.jpg"><meta itemprop=keywords content="homebrew,macos,french,"><meta property="og:title" content="Homebrew | Utilisez un package manager sous macOS"><meta property="og:description" content="Votre société ou votre client vient de vous confier un macbook pour travailler, il ne vous reste plus qu'à installer tout un ensemble de programmes pour commencer.
Sous linux, vous auriez un gestionnaire de formulas qui ferait bien l'affaire pour aller plus vite. Mais sous macOS, pas de apt-get, pas de yum, vous voilà parti pour installer tout cela à la main.
Pas de crainte, des gestionnaires de formulas existent aussi pour macOS comme Homebrew (ou MacPorts)"><meta property="og:type" content="article"><meta property="og:url" content="https://www.romainlespinasse.dev/posts/homebrew/"><meta property="og:image" content="https://www.romainlespinasse.dev/img/posts/homebrew/featured.jpg"><meta property="article:published_time" content="2017-02-28T10:42:00+01:00"><meta property="article:modified_time" content="2017-02-28T10:42:00+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.romainlespinasse.dev/img/posts/homebrew/featured.jpg"><meta name=twitter:title content="Homebrew | Utilisez un package manager sous macOS"><meta name=twitter:description content="Votre société ou votre client vient de vous confier un macbook pour travailler, il ne vous reste plus qu'à installer tout un ensemble de programmes pour commencer.
Sous linux, vous auriez un gestionnaire de formulas qui ferait bien l'affaire pour aller plus vite. Mais sous macOS, pas de apt-get, pas de yum, vous voilà parti pour installer tout cela à la main.
Pas de crainte, des gestionnaires de formulas existent aussi pour macOS comme Homebrew (ou MacPorts)"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Homebrew | Utilisez un package manager sous macOS</title><link rel=stylesheet href=https://www.romainlespinasse.dev/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous><style>.bg-img{background-image:url(https://www.romainlespinasse.dev/img/posts/homebrew/featured.jpg)}</style></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://www.romainlespinasse.dev>Romain Lespinasse</a></div><nav class="site-nav hide-in-mobile"><a href=https://www.romainlespinasse.dev/posts/>Technical posts</a>
<a href=https://www.romainlespinasse.dev/personal-projects/>Personal projects</a>
<a href=https://www.romainlespinasse.dev/townscaper/>Townscaper creations</a></nav></div><div class="hdr-right hdr-icons"><button id=img-btn class=hdr-btn title="Featured Image"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></button><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/rlespinasse target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://www.linkedin.com/in/romain-lespinasse target=_blank rel="noopener me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://github.com/rlespinasse target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://www.romainlespinasse.dev/posts/>Technical posts</a></li><li><a href=https://www.romainlespinasse.dev/personal-projects/>Personal projects</a></li><li><a href=https://www.romainlespinasse.dev/townscaper/>Townscaper creations</a></li></ul></div><div class=bg-img></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Feb 28, 2017</span></div><h1>Homebrew | Utilisez un package manager sous macOS</h1></header><div class=content><p>Votre société ou votre client vient de vous confier un macbook pour travailler,
il ne vous reste plus qu'à installer tout un ensemble de programmes pour commencer.</p><p>Sous linux, vous auriez un gestionnaire de formulas
qui ferait bien l'affaire pour aller plus vite.
Mais sous macOS, pas de apt-get, pas de yum,
vous voilà parti pour installer tout cela à la main.</p><p>Pas de crainte, des gestionnaires de formulas existent aussi pour macOS comme <a href=http://brew.sh/><strong>Homebrew</strong></a> (ou <a href=https://www.macports.org>MacPorts</a>)</p><p>Installer homebrew en une ligne de commande</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>/usr/bin/ruby -e <span class=s2>&#34;</span><span class=k>$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class=k>)</span><span class=s2>&#34;</span>
</code></pre></div><blockquote><p><strong>Homebrew</strong> est un gestionnaire basé sur des <strong>formulas</strong> d'installation de formula (en <strong>Ruby</strong>)
et utilise des <strong>repositories git</strong> comme conteneurs de ces <strong>formulas</strong>.</p></blockquote><p>Après une simple installation, vous avez à votre disposition une nouvelle commande,
petit tour du proprietaire :</p><p>La commande <strong>&ldquo;brew&rdquo;</strong> vous montre les commandes les plus courantes.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew
Example usage:
  brew search <span class=o>[</span>TEXT<span class=p>|</span>/REGEX/<span class=o>]</span>
  brew <span class=o>(</span>info<span class=p>|</span>home<span class=p>|</span>options<span class=o>)</span> <span class=o>[</span>FORMULA...<span class=o>]</span>
  brew install FORMULA...
  brew update
  brew upgrade <span class=o>[</span>FORMULA...<span class=o>]</span>
  brew uninstall FORMULA...
  brew list <span class=o>[</span>FORMULA...<span class=o>]</span>

Troubleshooting:
  brew config
  brew doctor
  brew install -vd FORMULA
</code></pre></div><p>Dans ces commandes, on retourne notamment celles pour gérer le <strong>cycle de vie de votre formula</strong></p><p>brew install FORMULA&mldr;
brew update
brew upgrade [FORMULA&mldr;]
brew uninstall FORMULA&mldr;</p><p>TIP: En executant <code>brew doctor</code>, vous vérifiez que votre installation de Homebrew est correcte.
La commande vous indiquera les différents problèmes de votre installation (s'il y en a).</p><p>Maintenant que homebrew est installé, vous souhaitez installer vos premiers formulas.</p><p>Vous commencez par vos besoins pour le projet.
Comme il s'agit d'un projet en <strong>Java</strong> sous <strong>Gradle</strong> avec des outils écrits en <strong>Go</strong>
et que l'ensemble est géré par Ansible, vous avez votre liste de formulas:</p><ul><li>Ansible</li><li>Java</li><li>Go</li><li>Gradle</li></ul><p>Vous installez vos formulas hors java</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew install ansible go gradle

$ ansible --version
ansible 2.2.0.0

$ go version
go version go1.7.4 darwin/amd64

$ gradle -v
Gradle 3.3
</code></pre></div><p>Vous installer java à part, car vous souhaitez installer java 8.</p><p>Vous rechercher donc les <strong>formulas</strong> nommées <strong>java</strong></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew search java
app-engine-java
google-java-format
javarepl
jslint4java
libreadline-java
homebrew/emacs/javaimp
Caskroom/cask/eclipse-java
Caskroom/cask/java
Caskroom/cask/netbeans-java-ee
Caskroom/cask/netbeans-java-se
Caskroom/cask/yourkit-java-profiler
Caskroom/versions/charles-applejava
Caskroom/versions/charles-beta-applejava
Caskroom/versions/java-beta
Caskroom/versions/java6
Caskroom/versions/java7
Caskroom/versions/java9-beta
</code></pre></div><p><strong>Aie</strong>, il n'y a pas de <strong>formula</strong> nommée <strong>java</strong> ou <strong>java8</strong>.
Par contre la recherche vous propose les formulas contenant le mot <strong>java</strong>.
Parmis les formulas, ceux avec un chemin (<strong>a/b/formula</strong>) sont des formulas contenues dans des <strong>taps</strong>.</p><p><strong>Mais qu'est-ce qu'un tap</strong>, il s'agit d'un autre <strong>repository git</strong>
contenant des formulas dédiées ou des nouvelles commandes.</p><blockquote><p>On installe un <strong>tap</strong> via la commande <code>brew tap utilisateur/nom_tap</code>.</p><p>Avec le tap <strong>utilisateur/nom_tap</strong>, brew installera le <strong>repository git</strong> associé à l'url <a href=https://github.com/utilisateur/homebrew-nom_tap>https://github.com/utilisateur/homebrew-nom_tap</a>.</p><p>Pour les autres possibilités, utilisez <code>brew tap -h</code>.</p></blockquote><p>TIP: <code>brew install a/b/formula</code> installera le <strong>tap</strong> et la formula en même temps.</p><p>Parmis les <strong>taps</strong> officiels, on peut trouver :</p><ul><li><a href=https://github.com/Homebrew/homebrew-core><strong>homebrew/core</strong></a> - <strong>Core formulae for the Homebrew formula manager</strong> <strong>(the default tap)</strong></li><li><a href=https://github.com/Homebrew/homebrew-science><strong>homebrew/science</strong></a> - <strong>Scientific formulae for the Homebrew formula manager</strong></li><li><a href=https://github.com/Homebrew/homebrew-games><strong>homebrew/games</strong></a> - <strong>Games formulae for the Homebrew formula manager</strong></li><li><a href=https://github.com/Homebrew/homebrew-completions><strong>homebrew/completions</strong></a> - <strong>Shell completion formulae for the Homebrew formula manager</strong></li><li><a href=https://github.com/Homebrew/homebrew-command-not-found><strong>homebrew/command-not-found</strong></a> - <strong>Ubuntu’s command-not-found equivalent for Homebrew on OSX</strong></li><li><a href=https://github.com/Homebrew/homebrew-services><strong>homebrew/services</strong></a> - <strong>Starts Homebrew formulae's plists with launchctl</strong></li></ul><p>Tous ces <strong>taps</strong> sont gérés par la communauté Homebrew,
mais certains <strong>taps</strong> officiels ne sont pas de Homebrew mais sont bien intégrés comme <strong>Caskroom/cask</strong>.</p><p>Les <strong>formulas</strong> de <strong>Caskroom/cask</strong> sont dédiés aux installations d'applications macOS</p><p>Maintenant, vous installez <strong>java 8</strong></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew install Caskroom/cask/java
<span class=o>=</span><span class=o>=</span>&gt; brew cask install Caskroom/cask/java
...

$ java -version
java version <span class=s2>&#34;1.8.0_112&#34;</span>
Java<span class=o>(</span>TM<span class=o>)</span> SE Runtime Environment <span class=o>(</span>build 1.8.0_112-b16<span class=o>)</span>
Java HotSpot<span class=o>(</span>TM<span class=o>)</span> 64-Bit Server VM <span class=o>(</span>build 25.112-b16, mixed mode<span class=o>)</span>
</code></pre></div><p>Lors du lancement de la commande, brew a transféré votre demande à <code>brew cask install</code> pour son installation.</p><p>Avec <strong>Cask</strong>, vous pouvez, en plus de vos formulas, installer votre navigateur, votre éditeur de code,&mldr;</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>brew cask install google-chrome intellij-idea docker slack
</code></pre></div><p>TIP: <code>brew tap caskroom/drivers</code> vous permet d'installer les drivers pour macOS.
Les fonts s'installent elles via <code>brew tap caskroom/fonts</code>.</p><p>Certains formulas sont gérées comme des <strong>services</strong> via macOS <strong>launchd</strong>.
Pour cela, brew propose, via <a href=https://github.com/Homebrew/homebrew-services><strong>homebrew/services</strong></a>,
la commande <strong>brew services</strong> pour faciliter leurs utilisations.</p><p>Pour votre projet, vous avez aussi besoin d'une base de données <strong>MySQL</strong>.</p><p>Vous installez <strong>MySQL</strong> qui possède un service sous macOS</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew install mysql

$ brew services list
Name           Status  User Plist
mysql          stopped

$ brew services start <span class=nv>mysql</span>
<span class=o>=</span><span class=o>=</span>&gt; Successfully started <span class=sb>`</span>mysql<span class=sb>`</span> <span class=o>(</span>label: homebrew.mxcl.mysql<span class=o>)</span>

$ brew services list
Name           Status  User            Plist
mysql          started &lt;your_username&gt; ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist
</code></pre></div><p>Votre installation de poste est terminée. Vous pouvez commencer à travailler.</p><p>Au bout d'un certain temps, vous souhaiteriez mettre à jour vos formulas.</p><p>La procédure de mise à jour se fait en deux commandes <strong>update</strong> + <strong>upgrade</strong>.
Avec ces 2 commandes, vous pouvez aussi utiliser deux autres commandes <strong>outdated</strong> et <strong>cleanup</strong> utiles suivant vos besoins.</p><ul><li><strong>update</strong> met à jour les <strong>repositories git</strong> des <strong>taps</strong>,</li></ul><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew update
Updated <span class=m>2</span> taps <span class=o>(</span>caskroom/cask, homebrew/core<span class=o>)</span>.
<span class=o>=</span><span class=o>=</span>&gt; New <span class=nv>Formulae</span>
<span class=o>=</span><span class=o>=</span>&gt; Updated Formulae
go ✔
</code></pre></div><ul><li><strong>upgrade</strong> met à jour les formulas,</li></ul><pre><code>$ brew upgrade
==&gt; Upgrading 1 outdated formula, with result:
go 1.7.4_1
==&gt; Upgrading go
==&gt; Downloading https://homebrew.bintray.com/bottles/go-1.7.4_1.sierra.bottle.tar.gz
...
🍺  /usr/local/Cellar/go/1.7.4_1: 6,438 files, 250.7M
</code></pre><ul><li><strong>outdated</strong> liste les formulas qui doivent être mis à jour,</li></ul><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew outdated
go <span class=o>(</span>1.6<span class=o>)</span> &lt; 1.7.4_1
</code></pre></div><ul><li><strong>cleanup</strong> supprime les anciennes versions des formulas (car Homebrew les garde indéfiniment).</li></ul><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew cleanup
Removing: /usr/local/Cellar/go/1.6... <span class=o>(</span>6,438 files, 250.7M<span class=o>)</span>
<span class=o>=</span><span class=o>=</span>&gt; This operation has freed approximately 250.7M of disk space.
</code></pre></div><blockquote><p>Définissez un alias <strong>bubu</strong> (déjà disponible par défaut dans <strong>zsh</strong>) pour <code>brew update && brew outdated && brew upgrade && brew cleanup</code>, et ainsi en une commande gèrer vos formulas plus simplement.</p></blockquote><p>Vous venez d'apprendre qu'un des mécanismes par défaut de Homebrew
est de conserver toutes les versions installées de vos formulas.
Ceci dans le but de vous permettre de facilement switcher entre ces versions.</p><blockquote><p><strong>brew install &lt;formula></strong> ne permet d'installer que la version courante du formula, jamais une ancienne version.</p></blockquote><p>Par exemple comment passer à une version go 1.6 puis revenir sur une version go 1.7</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew switch go 1.6
Cleaning /usr/local/Cellar/go/1.6
Cleaning /usr/local/Cellar/go/1.7.4_1
<span class=m>3</span> links created <span class=k>for</span> /usr/local/Cellar/go/1.6

$ brew switch go 1.7.4_1
Cleaning /usr/local/Cellar/go/1.6
Cleaning /usr/local/Cellar/go/1.7.4_1
<span class=m>3</span> links created <span class=k>for</span> /usr/local/Cellar/go/1.7.4_1
</code></pre></div><p>TIP: Le tap <strong>homebrew/versions</strong> vous permet d'accèder à d'anciennes versions.</p><p>Sur le projet, votre voisin de bureau commence sa première journée
et vous demande de lui passer votre liste de formulas et d'applications
pour faire lui aussi l'installation rapidement.</p><p>Vous appliquez la méthode KISS</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>brew list &gt; brew-formulas.txt
brew cask list &gt; brew-applications.txt
</code></pre></div><p>Et votre voisin devrait se débrouiller avec les deux fichers bruts que vous venez de lui envoyer par email.
C'est KISS mais seulement pour vous.</p><p>Mais là encore, Homebrew a pensé à faciliter ce genre d'actions via <strong>brew bundle</strong>.</p><p>Vous créez un Brewfile de votre poste via <code>brew bundle dump</code></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew bundle dump
$ cat Brewfile
tap <span class=s1>&#39;caskroom/cask&#39;</span>
tap <span class=s1>&#39;homebrew/bundle&#39;</span>
tap <span class=s1>&#39;homebrew/core&#39;</span>
tap <span class=s1>&#39;homebrew/services&#39;</span>
brew <span class=s1>&#39;ansible&#39;</span>
brew <span class=s1>&#39;go&#39;</span>
brew <span class=s1>&#39;mysql&#39;</span>, restart_service: <span class=nb>true</span>
brew <span class=s1>&#39;gradle&#39;</span>
cask <span class=s1>&#39;docker&#39;</span>
cask <span class=s1>&#39;google-chrome&#39;</span>
cask <span class=s1>&#39;intellij-idea&#39;</span>
cask <span class=s1>&#39;java&#39;</span>
cask <span class=s1>&#39;slack&#39;</span>
</code></pre></div><p>Un fichier <strong>Brewfile</strong> commence par lister les <strong>taps</strong> installés, puis les formulas installés, ainsi que les applications.
Il garde même en mémoire les status des services (ici, <strong>mysql</strong> est lancé).</p><p>Vous transmettez le fichier <strong>Brewfile</strong> à votre voisin et il n'a plus qu'à l'utiliser.</p><p>Votre voisin de bureau installe ce Brewfile sur son poste</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew bundle
Tapping caskroom/cask
Tapping homebrew/bundle
Using homebrew/core
Tapping homebrew/services
Installing ansible
Installing go
Installing gradle
Installing mysql
Installing docker
Installing google-chrome
Installing intellij-idea
Installing java
Installing slack
</code></pre></div><p>TIP: Par défaut, <strong>brew bundle</strong> utilise le fichier <strong>Brewfile</strong> depuis le dossier courant.
L'option <code>--file=path</code> permet de définir un autre chemin vers le fichier <strong>Brewfile</strong>.
L'option <code>--global</code> ira lire un fichier <strong>.Brefile</strong> depuis votre <strong>$HOME</strong>.</p><p>Après la découverte de <strong>brew bundle</strong>,
vous vous dites autant partager la liste des formulas nécessaire pour un projet spécifiquement.</p><p>Pour cela, il suffit de créer un fichier <strong>Brewfile</strong> dans vos sources de projet et de le commiter.
Comme cela un nouveau développeur n'a qu'à lancer <code>brew bundle</code> pour être sûr d'avoir le nécessaire pour travailler sur le projet.</p><p>Cela tombe bien, vous avez un nouveau projet en Java sous Gradle à faire et qui servira comme outil aux autres développeurs.</p><p>Vous créez un <strong>Brewfile</strong> dans votre nouveau projet avec Java et Gradle</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ <span class=nb>cd</span> project-tool
$ vim Brewfile
$ cat Brewfile
tap <span class=s1>&#39;caskroom/cask&#39;</span>
brew <span class=s1>&#39;gradle&#39;</span>
cask <span class=s1>&#39;java&#39;</span>
</code></pre></div><p>Après que ce nouveau projet soit prêt, il est temps que les autres développeurs l'utilisent.
Pour faciliter sa distribution, vous l'avez publié dans votre repository manager de votre client (ex. <strong>Nexus</strong>).</p><p>Un de vos collègues teste l'installation du nouvel outil</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ <span class=nv>tool_url</span><span class=o>=</span><span class=s1>&#39;https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip&#39;</span>
$ wget <span class=nv>$tool_url</span>
$ unzip tool-1.0.0-distribution.zip
$ tree
tool-1.0.0-distribution
├── bin
│   └── tool
└── lib
    └── tool-1.0.0.jar
$ chmod u+x tool-1.0.0-distribution/bin/tool
$ <span class=nb>echo</span> <span class=s2>&#34;</span><span class=s2>export PATH=\&#34;</span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span><span class=s2>/tool-1.0.0-distribution/bin:\$PATH\&#34;</span><span class=s2>&#34;</span> &gt;&gt; ~/.bashrc
$ . ~/.bashrc
$ tool --version
1.0.0
</code></pre></div><p>Mais la procédure d'installation n'est pas aussi simple que d'écrire <code>brew install project-tool</code>.
Pourquoi ne pas créer une <strong>formula</strong> aussi pour ce projet?</p><p>Avant de la créer, vous vous demandez comment la sauvegarder?
Homebrew vous propose déjà des <strong>taps</strong> pour avoir plus de <strong>formulas</strong> disponibles.</p><p>Vous pouvez créer un <strong>tap</strong> privé qui est un simple repository git.
Par défaut, un <strong>tap</strong> ajouté via <code>brew tap utilisateur/nom_tap</code> corresponds à l'url <a href=https://github.com/utilisateur/homebrew-nom_tap.git>https://github.com/utilisateur/homebrew-nom_tap.git</a></p><p>Si vous voulez le stocker ailleurs, l'ajout se fait par <code>brew tap utilisateur/nom_tap git@git.client.tld:utilisateur/homebrew-nom_tap.git</code>.</p><p>NOTE: Dans un <strong>Brewfile</strong>, ajouter la ligne <code>tap 'utilisateur/nom_tap', 'git@git.client.tld:utilisateur/homebrew-nom_tap.git'</code> pour déclarer ce tap.</p><p>Une fois que vous avez créé et ajouté ce <strong>tap</strong> privé, vous pouvez passer à la création de la <strong>formula</strong> via la commande <code>create</code>.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew create <span class=nv>$tool_url</span> --set-name project-tool --set-version 1.0.0 --tap utilisateur/nom_tap
<span class=o>=</span><span class=o>=</span>&gt; Downloading https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip
<span class=c1>######################################################################## 100,0%</span>
Please <span class=sb>`</span>brew audit --new-formula project-tool<span class=sb>`</span> before submitting, thanks.
Editing /usr/local/Homebrew/Library/Taps/utilisateur/nom_tap/project-tool.rb
</code></pre></div><p>Suite à la création de votre <strong>formula</strong>, homebrew ouvre automatiquement le fichier associé.</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=c1># Documentation: http://docs.brew.sh/Formula-Cookbook.html # &lt;1&gt;</span>
<span class=c1>#                http://www.rubydoc.info/github/Homebrew/brew/master/Formula</span>
<span class=c1># PLEASE REMOVE ALL GENERATED COMMENTS BEFORE SUBMITTING YOUR PULL REQUEST!</span>

<span class=k>class</span> <span class=nc>ProjectTool</span> <span class=o>&lt;</span> <span class=no>Formula</span>
  <span class=n>desc</span> <span class=s2>&#34;</span><span class=s2>&#34;</span>
  <span class=n>homepage</span> <span class=s2>&#34;</span><span class=s2>&#34;</span>
  <span class=n>url</span> <span class=s2>&#34;</span><span class=s2>https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip</span><span class=s2>&#34;</span> <span class=c1># &lt;2&gt;</span>
  <span class=n>version</span> <span class=s2>&#34;</span><span class=s2>1.0.0</span><span class=s2>&#34;</span>
  <span class=n>sha256</span> <span class=s2>&#34;</span><span class=s2>12259beb7c5a0954f2193f581a0c11ec63ff4a573ffeb35efba4b6389d36fad7</span><span class=s2>&#34;</span>

  <span class=c1># depends_on &#34;cmake&#34; =&gt; :build # &lt;3&gt;</span>

  <span class=k>def</span> <span class=nc></span><span class=o></span><span class=nf>install</span>
    <span class=c1># ENV.deparallelize  # if your formula fails when building in parallel</span>

    <span class=c1># Remove unrecognized options if warned by configure</span>
    <span class=nb>system</span> <span class=s2>&#34;</span><span class=s2>./configure</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=s2>--disable-debug</span><span class=s2>&#34;</span><span class=p>,</span>
                          <span class=s2>&#34;</span><span class=s2>--disable-dependency-tracking</span><span class=s2>&#34;</span><span class=p>,</span>
                          <span class=s2>&#34;</span><span class=s2>--disable-silent-rules</span><span class=s2>&#34;</span><span class=p>,</span>
                          <span class=s2>&#34;</span><span class=s2>--prefix=</span><span class=si>#{</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&#34;</span>
    <span class=c1># system &#34;cmake&#34;, &#34;.&#34;, *std_cmake_args</span>
    <span class=nb>system</span> <span class=s2>&#34;</span><span class=s2>make</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=s2>install</span><span class=s2>&#34;</span> <span class=c1># if this fails, try separate make/make install steps</span>
  <span class=k>end</span>

  <span class=nb>test</span> <span class=k>do</span>
    <span class=c1># `test do` will create, run in and delete a temporary directory.</span>
    <span class=c1>#</span>
    <span class=c1># This test will fail and we won&#39;t accept that! It&#39;s enough to just replace</span>
    <span class=c1># &#34;false&#34; with the main program this formula installs, but it&#39;d be nice if you</span>
    <span class=c1># were more thorough. Run the test with `brew test project-tool`. Options passed</span>
    <span class=c1># to `brew install` such as `--HEAD` also need to be provided to `brew test`.</span>
    <span class=c1>#</span>
    <span class=c1># The installed folder is not in the path, so use the entire path to any</span>
    <span class=c1># executables being tested: `system &#34;#{bin}/program&#34;, &#34;do&#34;, &#34;something&#34;`.</span>
    <span class=nb>system</span> <span class=s2>&#34;</span><span class=s2>false</span><span class=s2>&#34;</span>
  <span class=k>end</span>
<span class=k>end</span>
</code></pre></div><blockquote><ol><li>La formula vous fournie le lien vers la documentation pour finir sa création,</li><li>La formula contient déjà les informations données (ex. url, version) ou générées (ex. sha256),</li><li>Le reste du code est un template par défaut.</li></ol></blockquote><p>Vous pouvez <strong>auditer</strong> la formula pour savoir par où commencer</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew audit --new-formula project-tool
utilisateur/nom_tap/project-tool:
  * Formula should have a desc <span class=o>(</span>Description<span class=o>)</span>.
  * The homepage should start with http or https <span class=o>(</span>URL is <span class=o>)</span>.
  * The homepage  is not reachable <span class=o>(</span>HTTP status code 000<span class=o>)</span>
  * Please remove default template comments
  * Please remove default template comments
  * Commented-out dep <span class=s2>&#34;cmake&#34;</span> <span class=o>=</span>&gt; :build
  * Please remove default template comments
  * Please remove default template comments
  * Commented cmake call found
  * Please remove default template comments
Error: <span class=m>10</span> problems in <span class=m>1</span> formula
</code></pre></div><p>Vous devez donc définir la <strong>description</strong> et la <strong>homepage</strong> de la formula (ex. l'url du repository git).
Et comme il ne s'agit pas d'un <strong>build cmake</strong>, vous pouvez enlever les commentaires ainsi que le code lié à <strong>cmake</strong>.</p><p>Vous faites les premiers changements afin que l'audit passe</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=k>class</span> <span class=nc>ProjectTool</span> <span class=o>&lt;</span> <span class=no>Formula</span>
  <span class=n>desc</span> <span class=s2>&#34;</span><span class=s2>Installer l&#39;outil &#39;tool&#39; pour le projet</span><span class=s2>&#34;</span>
  <span class=n>homepage</span> <span class=s2>&#34;</span><span class=s2>https://git.client.tld/project/tool</span><span class=s2>&#34;</span>
  <span class=n>url</span> <span class=s2>&#34;</span><span class=s2>https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip</span><span class=s2>&#34;</span>
  <span class=n>version</span> <span class=s2>&#34;</span><span class=s2>1.0.0</span><span class=s2>&#34;</span>
  <span class=n>sha256</span> <span class=s2>&#34;</span><span class=s2>12259beb7c5a0954f2193f581a0c11ec63ff4a573ffeb35efba4b6389d36fad7</span><span class=s2>&#34;</span>

  <span class=k>def</span> <span class=nc></span><span class=o></span><span class=nf>install</span>
    <span class=c1># Il ne reste plus qu&#39;à faire la procédure d&#39;installation</span>
  <span class=k>end</span>

  <span class=nb>test</span> <span class=k>do</span>
    <span class=c1># Et tester la formula</span>
    <span class=nb>system</span> <span class=s2>&#34;</span><span class=s2>false</span><span class=s2>&#34;</span>
  <span class=k>end</span>
<span class=k>end</span>
</code></pre></div><p>Puis vous auditez et tentez d'installer la formula</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew audit --new-formula project-tool
$ brew install project-tool
<span class=o>=</span><span class=o>=</span>&gt; Installing project-tool from utilisateur/nom_tap
<span class=o>=</span><span class=o>=</span>&gt; Downloading https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip
Already downloaded: /Users/utilisateur/Library/Caches/Homebrew/project-tool-1.0.0.zip
Error: Empty installation
</code></pre></div><p>L'audit est bien passé, mais l'installation de la formula vous indique que la procédure d'installation reste à faire.</p><p>La procédure d'installation manuelle vous sert de guide dans l'écriture de votre formula</p><ol><li>Télécharger le zip,</li><li>Décompresser le zip,</li><li>Aller dans le dossier décompressé,</li><li>Rendre éxecutable le script <strong>bin/tool</strong>,</li><li>Ajouter le dossier <strong>bin</strong> au <strong>PATH</strong>,</li><li>Tester que <code>tool --version</code> donne bien le numéro de version de l'outil.</li></ol><p>Homebrew téléchargera et décompressera le zip du projet automatiquement (via <strong>url</strong> et <strong>sha256</strong>) réalisant les étapes 1 et 2.</p><p>Pour l'étape 3, la fonction <strong>install</strong> s'éxecute dans le dossier décompressé.
Par contre, ce dossier est temporaire, vous devez demander à garder les dossiers <strong>bin</strong> et <strong>lib</strong> dans <strong>libexec</strong>.</p><p>Une <strong>formula</strong> propose plusieurs répertoires pour stocker des fichiers utiles.
Le dossier <strong>libexec</strong> sert à stocker des fichiers uniquement nécessaire à la <strong>formula</strong>.
Via <code>libexec.install</code>, vous pouvez demander qu'un dossier y soit stocké.</p><p>Afin de réaliser l'étape 4, vous devez demander à lier le script <strong>libexec/bin/tool</strong> au PATH via <code>bin.install_symlink</code>.
Cette action réalise également l'étape 5 car <code>bin.install_symlink</code> gére aussi les permissions.</p><p>Le test de l'étape 6 se fera par <code>brew test</code>, ceci une fois la fonction <strong>test</strong> remplie dans la <strong>formula</strong>.
Ce test peut simplement être que l'éxecution de <code>tool --version</code> fonctionne.</p><p>De plus, une formula peut définir des pré-requis comme par exemple que Java 8 (ou plus) soit installé.
Via <code>depends_on :java => "1.8+"</code> vous définissez un tel prérequis.</p><p>Vous ajoutez les différentes étapes dans la formula</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=k>class</span> <span class=nc>ProjectTool</span> <span class=o>&lt;</span> <span class=no>Formula</span>
  <span class=n>desc</span> <span class=s2>&#34;</span><span class=s2>Installer l&#39;outil &#39;tool&#39; pour le projet</span><span class=s2>&#34;</span>
  <span class=n>homepage</span> <span class=s2>&#34;</span><span class=s2>https://git.client.tld/project/tool</span><span class=s2>&#34;</span>
  <span class=n>url</span> <span class=s2>&#34;</span><span class=s2>https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip</span><span class=s2>&#34;</span>
  <span class=n>version</span> <span class=s2>&#34;</span><span class=s2>1.0.0</span><span class=s2>&#34;</span>
  <span class=n>sha256</span> <span class=s2>&#34;</span><span class=s2>12259beb7c5a0954f2193f581a0c11ec63ff4a573ffeb35efba4b6389d36fad7</span><span class=s2>&#34;</span>

  <span class=n>depends_on</span> <span class=ss>:java</span> <span class=o>=</span><span class=o>&gt;</span> <span class=s2>&#34;</span><span class=s2>1.8+</span><span class=s2>&#34;</span>

  <span class=k>def</span> <span class=nc></span><span class=o></span><span class=nf>install</span>
    <span class=n>libexec</span><span class=o>.</span><span class=n>install</span> <span class=sx>%w[</span><span class=sx>bin lib</span><span class=sx>]</span>
    <span class=n>bin</span><span class=o>.</span><span class=n>install_symlink</span> <span class=no>Dir</span><span class=o>[</span><span class=s2>&#34;</span><span class=si>#{</span><span class=n>libexec</span><span class=si>}</span><span class=s2>/bin/*</span><span class=s2>&#34;</span><span class=o>]</span>
  <span class=k>end</span>

  <span class=nb>test</span> <span class=k>do</span>
    <span class=nb>system</span> <span class=s2>&#34;</span><span class=si>#{</span><span class=n>bin</span><span class=si>}</span><span class=s2>/tool</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=s2>--version</span><span class=s2>&#34;</span>
  <span class=k>end</span>
<span class=k>end</span>
</code></pre></div><p>Afin de correctement tester cette <strong>formula</strong>, vous devez</p><ul><li>l'auditer avec <code>brew audit</code>,</li><li>l'installer avec <code>brew install</code>,</li><li>la tester avec <code>brew test</code>.</li></ul><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew audit --new-formula project-tool
$ brew install project-tool
<span class=o>=</span><span class=o>=</span>&gt; Installing project-tool from utilisateur/nom_tap
<span class=o>=</span><span class=o>=</span>&gt; Downloading https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip
Already downloaded: /Users/utilisateur/Library/Caches/Homebrew/project-tool-1.0.0.zip
🍺  /usr/local/Cellar/project-tool/1.0.0: <span class=m>4</span> files, 100K, built in <span class=m>0</span> seconds
 $ brew <span class=nb>test</span> project-tool
Testing utilisateur/nom_tap/project-tool
<span class=o>=</span><span class=o>=</span>&gt; Using the <span class=nv>sandbox</span>
<span class=o>=</span><span class=o>=</span>&gt; /usr/local/Cellar/project-tool/1.0.0/bin/tool --version
</code></pre></div><blockquote><p>Vous pouvez aussi vérifier le style de la formula via <code>brew style</code>.</p></blockquote><p>Comme tout s'est bien passé, vous souhaitez maintenant la <strong>commiter</strong> pour que vos collègues puissent l'installer plus simplement.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=nb>cd</span> <span class=k>$(</span>brew --repo utilisateur/nom_tap<span class=k>)</span>
git add Formula/project-tool.rb
git commit
</code></pre></div><p>Votre collègue apprécie la nouvelle procédure</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>brew tap utilisateur/nom_tap git@git.client.tld:utilisateur/homebrew-nom_tap.git
brew install project-tool
</code></pre></div><p>NOTE: le système de <strong>formula** permet également de gérer l'installation depuis les sources (</strong>&ndash;HEAD**<a href=https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md#head></a>)
ou les versions bêta (<a href=https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md#devel><strong>&ndash;devel</strong></a>).
La documentation des formulas vous permettera d'approfondir vos formulas (<a href=http://docs.brew.sh/Formula-Cookbook.html>http://docs.brew.sh/Formula-Cookbook.html</a>).</p><p>Maintenant que vous savez créer des <strong>formulas</strong> pour votre client,
vous pouvez aussi créer des formulas ou les maintenir sur les <strong>taps</strong> officiels.</p><p>Pour contribuer, la formula dans les taps officiels (comme <strong>homebrew-core</strong>) doit respecter <a href=https://github.com/Homebrew/brew/blob/master/docs/Acceptable-Formulae.md>certaines conditions pour être acceptable</a>.</p><p>Le projet installé par la formula doit être</p><ul><li>open-source,</li><li>stable, maintenu, connu, et utilisé,</li><li>installable depuis ces sources.</li></ul><p>Une fois la formula créée ou modifiée, vous pouvez créer une pull-request vers le project <strong>homebrew-core</strong>.
Votre pull-request sera automatiquement analysée et validée par <a href=https://bot.brew.sh/>bot.brew.sh</a>.</p><p>Dans le but d'aider les mainteneurs du projet, <a href=https://bot.brew.sh/>bot.brew.sh</a> traite toutes pull-requests
en testant la formula sur les trois dernières versions supportées de macOS (<strong>yosemite, el capitan, et sierra</strong>).</p><p>Concernant votre projet <strong>tool</strong>, il ne vous reste plus qu'à le rendre open-source
et proposer votre <strong>formula</strong> sur <strong>homebrew-core</strong> quand le projet sera plus connu.</p><p>En attendant ce jour, n'hesitez pas à contribuer sur les formulas existantes et rejoindre les 6200 contibuteurs de <strong>homebrew-core</strong>.</p><p>Cet article a été publié en premier sur <a href=https://sfeir.com>lemag.sfeir.com</a>.</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://www.romainlespinasse.dev/tags/homebrew>homebrew</a></span><span class=tag><a href=https://www.romainlespinasse.dev/tags/macos>macos</a></span><span class=tag><a href=https://www.romainlespinasse.dev/tags/french>french</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>2632 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2017-02-28 09:42 +0000</p></footer></article><div class="post-nav thin"><a class=next-post href=https://www.romainlespinasse.dev/posts/antora/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>Antora | Remplacer votre wiki par un site de documentation</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2020 <a href=https://www.romainlespinasse.dev>Romain Lespinasse</a> &#183; <a href=https://tldrlegal.com/license/mit-license target=_blank rel=noopener>MIT License</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://www.romainlespinasse.dev/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://www.romainlespinasse.dev/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-150515783-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>