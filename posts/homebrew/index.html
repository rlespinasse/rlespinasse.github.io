<!doctype html><html><head lang=en>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>Homebrew | Utilisez un package manager sous macOS - Romain Lespinasse</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Découvrez homebrew pour vous facilitez la vie sous macOS dans la gestion de vos installations de packages.">
<meta property="og:image" content>
<meta property="og:title" content="Homebrew | Utilisez un package manager sous macOS">
<meta property="og:description" content="Découvrez homebrew pour vous facilitez la vie sous macOS dans la gestion de vos installations de packages.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.romainlespinasse.dev/posts/homebrew/"><meta property="og:image" content="https://www.romainlespinasse.dev/img/posts/homebrew/featured.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2017-02-28T10:42:00+01:00">
<meta property="article:modified_time" content="2017-02-28T10:42:00+01:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://www.romainlespinasse.dev/img/posts/homebrew/featured.jpg">
<meta name=twitter:title content="Homebrew | Utilisez un package manager sous macOS">
<meta name=twitter:description content="Découvrez homebrew pour vous facilitez la vie sous macOS dans la gestion de vos installations de packages.">
<script src=https://www.romainlespinasse.devjs/feather.min.js></script>
<link href=https://www.romainlespinasse.dev/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet>
<link rel=stylesheet type=text/css media=screen href=https://www.romainlespinasse.dev/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css>
<link id=darkModeStyle rel=stylesheet type=text/css href=https://www.romainlespinasse.dev/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css disabled>
<script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script>
</head>
<body>
<div class=content><header>
<div class=main>
<a href=https://www.romainlespinasse.dev>Romain Lespinasse</a>
</div>
<nav>
<a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a>
| <span id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://www.romainlespinasse.devjs/themetoggle.js></script>
</nav>
</header>
<main>
<article>
<div class=title>
<h1 class=title>Homebrew | Utilisez un package manager sous macOS</h1>
<div class=meta>Posted on Feb 28, 2017</div>
</div>
<section class=body>
<p>Votre société ou votre client vient de vous confier un macbook pour travailler,
il ne vous reste plus qu&rsquo;à installer tout un ensemble de programmes pour commencer.</p>
<p>Sous linux, vous auriez un gestionnaire de formulas
qui ferait bien l&rsquo;affaire pour aller plus vite.
Mais sous macOS, pas de apt-get, pas de yum,
vous voilà parti pour installer tout cela à la main.</p>
<p>Pas de crainte, des gestionnaires de formulas existent aussi pour macOS comme <a href=http://brew.sh/><strong>Homebrew</strong></a> (ou <a href=https://www.macports.org>MacPorts</a>)</p>
<p>Installer homebrew en une ligne de commande</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/usr/bin/ruby -e <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><blockquote>
<p><strong>Homebrew</strong> est un gestionnaire basé sur des <strong>formulas</strong> d&rsquo;installation de formula (en <strong>Ruby</strong>)
et utilise des <strong>repositories git</strong> comme conteneurs de ces <strong>formulas</strong>.</p>
</blockquote>
<p>Après une simple installation, vous avez à votre disposition une nouvelle commande,
petit tour du proprietaire :</p>
<p>La commande <strong>&ldquo;brew&rdquo;</strong> vous montre les commandes les plus courantes.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew
Example usage:
  brew search <span style=color:#f92672>[</span>TEXT|/REGEX/<span style=color:#f92672>]</span>
  brew <span style=color:#f92672>(</span>info|home|options<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>FORMULA...<span style=color:#f92672>]</span>
  brew install FORMULA...
  brew update
  brew upgrade <span style=color:#f92672>[</span>FORMULA...<span style=color:#f92672>]</span>
  brew uninstall FORMULA...
  brew list <span style=color:#f92672>[</span>FORMULA...<span style=color:#f92672>]</span>

Troubleshooting:
  brew config
  brew doctor
  brew install -vd FORMULA
</code></pre></div><p>Dans ces commandes, on retourne notamment celles pour gérer le <strong>cycle de vie de votre formula</strong></p>
<p>brew install FORMULA&mldr;
brew update
brew upgrade [FORMULA&mldr;]
brew uninstall FORMULA&mldr;</p>
<p>TIP: En executant <code>brew doctor</code>, vous vérifiez que votre installation de Homebrew est correcte.
La commande vous indiquera les différents problèmes de votre installation (s&rsquo;il y en a).</p>
<p>Maintenant que homebrew est installé, vous souhaitez installer vos premiers formulas.</p>
<p>Vous commencez par vos besoins pour le projet.
Comme il s&rsquo;agit d&rsquo;un projet en <strong>Java</strong> sous <strong>Gradle</strong> avec des outils écrits en <strong>Go</strong>
et que l&rsquo;ensemble est géré par Ansible, vous avez votre liste de formulas:</p>
<ul>
<li>Ansible</li>
<li>Java</li>
<li>Go</li>
<li>Gradle</li>
</ul>
<p>Vous installez vos formulas hors java</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew install ansible go gradle

$ ansible --version
ansible 2.2.0.0

$ go version
go version go1.7.4 darwin/amd64

$ gradle -v
Gradle 3.3
</code></pre></div><p>Vous installer java à part, car vous souhaitez installer java 8.</p>
<p>Vous rechercher donc les <strong>formulas</strong> nommées <strong>java</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew search java
app-engine-java
google-java-format
javarepl
jslint4java
libreadline-java
homebrew/emacs/javaimp
Caskroom/cask/eclipse-java
Caskroom/cask/java
Caskroom/cask/netbeans-java-ee
Caskroom/cask/netbeans-java-se
Caskroom/cask/yourkit-java-profiler
Caskroom/versions/charles-applejava
Caskroom/versions/charles-beta-applejava
Caskroom/versions/java-beta
Caskroom/versions/java6
Caskroom/versions/java7
Caskroom/versions/java9-beta
</code></pre></div><p><strong>Aie</strong>, il n&rsquo;y a pas de <strong>formula</strong> nommée <strong>java</strong> ou <strong>java8</strong>.
Par contre la recherche vous propose les formulas contenant le mot <strong>java</strong>.
Parmis les formulas, ceux avec un chemin (<strong>a/b/formula</strong>) sont des formulas contenues dans des <strong>taps</strong>.</p>
<p><strong>Mais qu&rsquo;est-ce qu&rsquo;un tap</strong>, il s&rsquo;agit d&rsquo;un autre <strong>repository git</strong>
contenant des formulas dédiées ou des nouvelles commandes.</p>
<blockquote>
<p>On installe un <strong>tap</strong> via la commande <code>brew tap utilisateur/nom_tap</code>.</p>
<p>Avec le tap <strong>utilisateur/nom_tap</strong>, brew installera le <strong>repository git</strong> associé à l&rsquo;url <a href=https://github.com/utilisateur/homebrew-nom_tap>https://github.com/utilisateur/homebrew-nom_tap</a>.</p>
<p>Pour les autres possibilités, utilisez <code>brew tap -h</code>.</p>
</blockquote>
<p>TIP: <code>brew install a/b/formula</code> installera le <strong>tap</strong> et la formula en même temps.</p>
<p>Parmis les <strong>taps</strong> officiels, on peut trouver :</p>
<ul>
<li><a href=https://github.com/Homebrew/homebrew-core><strong>homebrew/core</strong></a> - <strong>Core formulae for the Homebrew formula manager</strong> <strong>(the default tap)</strong></li>
<li><a href=https://github.com/Homebrew/homebrew-science><strong>homebrew/science</strong></a> - <strong>Scientific formulae for the Homebrew formula manager</strong></li>
<li><a href=https://github.com/Homebrew/homebrew-games><strong>homebrew/games</strong></a> - <strong>Games formulae for the Homebrew formula manager</strong></li>
<li><a href=https://github.com/Homebrew/homebrew-completions><strong>homebrew/completions</strong></a> - <strong>Shell completion formulae for the Homebrew formula manager</strong></li>
<li><a href=https://github.com/Homebrew/homebrew-command-not-found><strong>homebrew/command-not-found</strong></a> - <strong>Ubuntu’s command-not-found equivalent for Homebrew on OSX</strong></li>
<li><a href=https://github.com/Homebrew/homebrew-services><strong>homebrew/services</strong></a> - <strong>Starts Homebrew formulae&rsquo;s plists with launchctl</strong></li>
</ul>
<p>Tous ces <strong>taps</strong> sont gérés par la communauté Homebrew,
mais certains <strong>taps</strong> officiels ne sont pas de Homebrew mais sont bien intégrés comme <strong>Caskroom/cask</strong>.</p>
<p>Les <strong>formulas</strong> de <strong>Caskroom/cask</strong> sont dédiés aux installations d&rsquo;applications macOS</p>
<p>Maintenant, vous installez <strong>java 8</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew install Caskroom/cask/java
<span style=color:#f92672>==</span>&gt; brew cask install Caskroom/cask/java
...

$ java -version
java version <span style=color:#e6db74>&#34;1.8.0_112&#34;</span>
Java<span style=color:#f92672>(</span>TM<span style=color:#f92672>)</span> SE Runtime Environment <span style=color:#f92672>(</span>build 1.8.0_112-b16<span style=color:#f92672>)</span>
Java HotSpot<span style=color:#f92672>(</span>TM<span style=color:#f92672>)</span> 64-Bit Server VM <span style=color:#f92672>(</span>build 25.112-b16, mixed mode<span style=color:#f92672>)</span>
</code></pre></div><p>Lors du lancement de la commande, brew a transféré votre demande à <code>brew cask install</code> pour son installation.</p>
<p>Avec <strong>Cask</strong>, vous pouvez, en plus de vos formulas, installer votre navigateur, votre éditeur de code,&mldr;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>brew cask install google-chrome intellij-idea docker slack
</code></pre></div><p>TIP: <code>brew tap caskroom/drivers</code> vous permet d&rsquo;installer les drivers pour macOS.
Les fonts s&rsquo;installent elles via <code>brew tap caskroom/fonts</code>.</p>
<p>Certains formulas sont gérées comme des <strong>services</strong> via macOS <strong>launchd</strong>.
Pour cela, brew propose, via <a href=https://github.com/Homebrew/homebrew-services><strong>homebrew/services</strong></a>,
la commande <strong>brew services</strong> pour faciliter leurs utilisations.</p>
<p>Pour votre projet, vous avez aussi besoin d&rsquo;une base de données <strong>MySQL</strong>.</p>
<p>Vous installez <strong>MySQL</strong> qui possède un service sous macOS</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew install mysql

$ brew services list
Name           Status  User Plist
mysql          stopped

$ brew services start mysql
<span style=color:#f92672>==</span>&gt; Successfully started <span style=color:#e6db74>`</span>mysql<span style=color:#e6db74>`</span> <span style=color:#f92672>(</span>label: homebrew.mxcl.mysql<span style=color:#f92672>)</span>

$ brew services list
Name           Status  User            Plist
mysql          started &lt;your_username&gt; ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist
</code></pre></div><p>Votre installation de poste est terminée. Vous pouvez commencer à travailler.</p>
<p>Au bout d&rsquo;un certain temps, vous souhaiteriez mettre à jour vos formulas.</p>
<p>La procédure de mise à jour se fait en deux commandes <strong>update</strong> + <strong>upgrade</strong>.
Avec ces 2 commandes, vous pouvez aussi utiliser deux autres commandes <strong>outdated</strong> et <strong>cleanup</strong> utiles suivant vos besoins.</p>
<ul>
<li><strong>update</strong> met à jour les <strong>repositories git</strong> des <strong>taps</strong>,</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew update
Updated <span style=color:#ae81ff>2</span> taps <span style=color:#f92672>(</span>caskroom/cask, homebrew/core<span style=color:#f92672>)</span>.
<span style=color:#f92672>==</span>&gt; New Formulae
<span style=color:#f92672>==</span>&gt; Updated Formulae
go ✔
</code></pre></div><ul>
<li><strong>upgrade</strong> met à jour les formulas,</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$ brew upgrade
==&gt; Upgrading 1 outdated formula, with result:
go 1.7.4_1
==&gt; Upgrading go
==&gt; Downloading https://homebrew.bintray.com/bottles/go-1.7.4_1.sierra.bottle.tar.gz
...
🍺  /usr/local/Cellar/go/1.7.4_1: 6,438 files, 250.7M
</code></pre></div><ul>
<li><strong>outdated</strong> liste les formulas qui doivent être mis à jour,</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew outdated
go <span style=color:#f92672>(</span>1.6<span style=color:#f92672>)</span> &lt; 1.7.4_1
</code></pre></div><ul>
<li><strong>cleanup</strong> supprime les anciennes versions des formulas (car Homebrew les garde indéfiniment).</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew cleanup
Removing: /usr/local/Cellar/go/1.6... <span style=color:#f92672>(</span>6,438 files, 250.7M<span style=color:#f92672>)</span>
<span style=color:#f92672>==</span>&gt; This operation has freed approximately 250.7M of disk space.
</code></pre></div><blockquote>
<p>Définissez un alias <strong>bubu</strong> (déjà disponible par défaut dans <strong>zsh</strong>) pour <code>brew update && brew outdated && brew upgrade && brew cleanup</code>, et ainsi en une commande gèrer vos formulas plus simplement.</p>
</blockquote>
<p>Vous venez d&rsquo;apprendre qu&rsquo;un des mécanismes par défaut de Homebrew
est de conserver toutes les versions installées de vos formulas.
Ceci dans le but de vous permettre de facilement switcher entre ces versions.</p>
<blockquote>
<p><strong>brew install &lt;formula></strong> ne permet d&rsquo;installer que la version courante du formula, jamais une ancienne version.</p>
</blockquote>
<p>Par exemple comment passer à une version go 1.6 puis revenir sur une version go 1.7</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew switch go 1.6
Cleaning /usr/local/Cellar/go/1.6
Cleaning /usr/local/Cellar/go/1.7.4_1
<span style=color:#ae81ff>3</span> links created <span style=color:#66d9ef>for</span> /usr/local/Cellar/go/1.6

$ brew switch go 1.7.4_1
Cleaning /usr/local/Cellar/go/1.6
Cleaning /usr/local/Cellar/go/1.7.4_1
<span style=color:#ae81ff>3</span> links created <span style=color:#66d9ef>for</span> /usr/local/Cellar/go/1.7.4_1
</code></pre></div><p>TIP: Le tap <strong>homebrew/versions</strong> vous permet d&rsquo;accèder à d&rsquo;anciennes versions.</p>
<p>Sur le projet, votre voisin de bureau commence sa première journée
et vous demande de lui passer votre liste de formulas et d&rsquo;applications
pour faire lui aussi l&rsquo;installation rapidement.</p>
<p>Vous appliquez la méthode KISS</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>brew list &gt; brew-formulas.txt
brew cask list &gt; brew-applications.txt
</code></pre></div><p>Et votre voisin devrait se débrouiller avec les deux fichers bruts que vous venez de lui envoyer par email.
C&rsquo;est KISS mais seulement pour vous.</p>
<p>Mais là encore, Homebrew a pensé à faciliter ce genre d&rsquo;actions via <strong>brew bundle</strong>.</p>
<p>Vous créez un Brewfile de votre poste via <code>brew bundle dump</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew bundle dump
$ cat Brewfile
tap <span style=color:#e6db74>&#39;caskroom/cask&#39;</span>
tap <span style=color:#e6db74>&#39;homebrew/bundle&#39;</span>
tap <span style=color:#e6db74>&#39;homebrew/core&#39;</span>
tap <span style=color:#e6db74>&#39;homebrew/services&#39;</span>
brew <span style=color:#e6db74>&#39;ansible&#39;</span>
brew <span style=color:#e6db74>&#39;go&#39;</span>
brew <span style=color:#e6db74>&#39;mysql&#39;</span>, restart_service: true
brew <span style=color:#e6db74>&#39;gradle&#39;</span>
cask <span style=color:#e6db74>&#39;docker&#39;</span>
cask <span style=color:#e6db74>&#39;google-chrome&#39;</span>
cask <span style=color:#e6db74>&#39;intellij-idea&#39;</span>
cask <span style=color:#e6db74>&#39;java&#39;</span>
cask <span style=color:#e6db74>&#39;slack&#39;</span>
</code></pre></div><p>Un fichier <strong>Brewfile</strong> commence par lister les <strong>taps</strong> installés, puis les formulas installés, ainsi que les applications.
Il garde même en mémoire les status des services (ici, <strong>mysql</strong> est lancé).</p>
<p>Vous transmettez le fichier <strong>Brewfile</strong> à votre voisin et il n&rsquo;a plus qu&rsquo;à l&rsquo;utiliser.</p>
<p>Votre voisin de bureau installe ce Brewfile sur son poste</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew bundle
Tapping caskroom/cask
Tapping homebrew/bundle
Using homebrew/core
Tapping homebrew/services
Installing ansible
Installing go
Installing gradle
Installing mysql
Installing docker
Installing google-chrome
Installing intellij-idea
Installing java
Installing slack
</code></pre></div><p>TIP: Par défaut, <strong>brew bundle</strong> utilise le fichier <strong>Brewfile</strong> depuis le dossier courant.
L&rsquo;option <code>--file=path</code> permet de définir un autre chemin vers le fichier <strong>Brewfile</strong>.
L&rsquo;option <code>--global</code> ira lire un fichier <strong>.Brefile</strong> depuis votre <strong>$HOME</strong>.</p>
<p>Après la découverte de <strong>brew bundle</strong>,
vous vous dites autant partager la liste des formulas nécessaire pour un projet spécifiquement.</p>
<p>Pour cela, il suffit de créer un fichier <strong>Brewfile</strong> dans vos sources de projet et de le commiter.
Comme cela un nouveau développeur n&rsquo;a qu&rsquo;à lancer <code>brew bundle</code> pour être sûr d&rsquo;avoir le nécessaire pour travailler sur le projet.</p>
<p>Cela tombe bien, vous avez un nouveau projet en Java sous Gradle à faire et qui servira comme outil aux autres développeurs.</p>
<p>Vous créez un <strong>Brewfile</strong> dans votre nouveau projet avec Java et Gradle</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ cd project-tool
$ vim Brewfile
$ cat Brewfile
tap <span style=color:#e6db74>&#39;caskroom/cask&#39;</span>
brew <span style=color:#e6db74>&#39;gradle&#39;</span>
cask <span style=color:#e6db74>&#39;java&#39;</span>
</code></pre></div><p>Après que ce nouveau projet soit prêt, il est temps que les autres développeurs l&rsquo;utilisent.
Pour faciliter sa distribution, vous l&rsquo;avez publié dans votre repository manager de votre client (ex. <strong>Nexus</strong>).</p>
<p>Un de vos collègues teste l&rsquo;installation du nouvel outil</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ tool_url<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip&#39;</span>
$ wget $tool_url
$ unzip tool-1.0.0-distribution.zip
$ tree
tool-1.0.0-distribution
├── bin
│   └── tool
└── lib
    └── tool-1.0.0.jar
$ chmod u+x tool-1.0.0-distribution/bin/tool
$ echo <span style=color:#e6db74>&#34;export PATH=\&#34;</span><span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span><span style=color:#e6db74>/tool-1.0.0-distribution/bin:\$PATH\&#34;&#34;</span> &gt;&gt; ~/.bashrc
$ . ~/.bashrc
$ tool --version
1.0.0
</code></pre></div><p>Mais la procédure d&rsquo;installation n&rsquo;est pas aussi simple que d&rsquo;écrire <code>brew install project-tool</code>.
Pourquoi ne pas créer une <strong>formula</strong> aussi pour ce projet?</p>
<p>Avant de la créer, vous vous demandez comment la sauvegarder?
Homebrew vous propose déjà des <strong>taps</strong> pour avoir plus de <strong>formulas</strong> disponibles.</p>
<p>Vous pouvez créer un <strong>tap</strong> privé qui est un simple repository git.
Par défaut, un <strong>tap</strong> ajouté via <code>brew tap utilisateur/nom_tap</code> corresponds à l&rsquo;url <a href=https://github.com/utilisateur/homebrew-nom_tap.git>https://github.com/utilisateur/homebrew-nom_tap.git</a></p>
<p>Si vous voulez le stocker ailleurs, l&rsquo;ajout se fait par <code>brew tap utilisateur/nom_tap git@git.client.tld:utilisateur/homebrew-nom_tap.git</code>.</p>
<p>NOTE: Dans un <strong>Brewfile</strong>, ajouter la ligne <code>tap 'utilisateur/nom_tap', 'git@git.client.tld:utilisateur/homebrew-nom_tap.git'</code> pour déclarer ce tap.</p>
<p>Une fois que vous avez créé et ajouté ce <strong>tap</strong> privé, vous pouvez passer à la création de la <strong>formula</strong> via la commande <code>create</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew create $tool_url --set-name project-tool --set-version 1.0.0 --tap utilisateur/nom_tap
<span style=color:#f92672>==</span>&gt; Downloading https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip
<span style=color:#75715e>######################################################################## 100,0%</span>
Please <span style=color:#e6db74>`</span>brew audit --new-formula project-tool<span style=color:#e6db74>`</span> before submitting, thanks.
Editing /usr/local/Homebrew/Library/Taps/utilisateur/nom_tap/project-tool.rb
</code></pre></div><p>Suite à la création de votre <strong>formula</strong>, homebrew ouvre automatiquement le fichier associé.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#75715e># Documentation: http://docs.brew.sh/Formula-Cookbook.html # &lt;1&gt;</span>
<span style=color:#75715e>#                http://www.rubydoc.info/github/Homebrew/brew/master/Formula</span>
<span style=color:#75715e># PLEASE REMOVE ALL GENERATED COMMENTS BEFORE SUBMITTING YOUR PULL REQUEST!</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProjectTool</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>Formula</span>
  desc <span style=color:#e6db74>&#34;&#34;</span>
  homepage <span style=color:#e6db74>&#34;&#34;</span>
  url <span style=color:#e6db74>&#34;https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip&#34;</span> <span style=color:#75715e># &lt;2&gt;</span>
  version <span style=color:#e6db74>&#34;1.0.0&#34;</span>
  sha256 <span style=color:#e6db74>&#34;12259beb7c5a0954f2193f581a0c11ec63ff4a573ffeb35efba4b6389d36fad7&#34;</span>

  <span style=color:#75715e># depends_on &#34;cmake&#34; =&gt; :build # &lt;3&gt;</span>

  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>install</span>
    <span style=color:#75715e># ENV.deparallelize  # if your formula fails when building in parallel</span>

    <span style=color:#75715e># Remove unrecognized options if warned by configure</span>
    system <span style=color:#e6db74>&#34;./configure&#34;</span>, <span style=color:#e6db74>&#34;--disable-debug&#34;</span>,
                          <span style=color:#e6db74>&#34;--disable-dependency-tracking&#34;</span>,
                          <span style=color:#e6db74>&#34;--disable-silent-rules&#34;</span>,
                          <span style=color:#e6db74>&#34;--prefix=</span><span style=color:#e6db74>#{</span>prefix<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
    <span style=color:#75715e># system &#34;cmake&#34;, &#34;.&#34;, *std_cmake_args</span>
    system <span style=color:#e6db74>&#34;make&#34;</span>, <span style=color:#e6db74>&#34;install&#34;</span> <span style=color:#75715e># if this fails, try separate make/make install steps</span>
  <span style=color:#66d9ef>end</span>

  test <span style=color:#66d9ef>do</span>
    <span style=color:#75715e># `test do` will create, run in and delete a temporary directory.</span>
    <span style=color:#75715e>#</span>
    <span style=color:#75715e># This test will fail and we won&#39;t accept that! It&#39;s enough to just replace</span>
    <span style=color:#75715e># &#34;false&#34; with the main program this formula installs, but it&#39;d be nice if you</span>
    <span style=color:#75715e># were more thorough. Run the test with `brew test project-tool`. Options passed</span>
    <span style=color:#75715e># to `brew install` such as `--HEAD` also need to be provided to `brew test`.</span>
    <span style=color:#75715e>#</span>
    <span style=color:#75715e># The installed folder is not in the path, so use the entire path to any</span>
    <span style=color:#75715e># executables being tested: `system &#34;#{bin}/program&#34;, &#34;do&#34;, &#34;something&#34;`.</span>
    system <span style=color:#e6db74>&#34;false&#34;</span>
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><blockquote>
<ol>
<li>La formula vous fournie le lien vers la documentation pour finir sa création,</li>
<li>La formula contient déjà les informations données (ex. url, version) ou générées (ex. sha256),</li>
<li>Le reste du code est un template par défaut.</li>
</ol>
</blockquote>
<p>Vous pouvez <strong>auditer</strong> la formula pour savoir par où commencer</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew audit --new-formula project-tool
utilisateur/nom_tap/project-tool:
  * Formula should have a desc <span style=color:#f92672>(</span>Description<span style=color:#f92672>)</span>.
  * The homepage should start with http or https <span style=color:#f92672>(</span>URL is <span style=color:#f92672>)</span>.
  * The homepage  is not reachable <span style=color:#f92672>(</span>HTTP status code 000<span style=color:#f92672>)</span>
  * Please remove default template comments
  * Please remove default template comments
  * Commented-out dep <span style=color:#e6db74>&#34;cmake&#34;</span> <span style=color:#f92672>=</span>&gt; :build
  * Please remove default template comments
  * Please remove default template comments
  * Commented cmake call found
  * Please remove default template comments
Error: <span style=color:#ae81ff>10</span> problems in <span style=color:#ae81ff>1</span> formula
</code></pre></div><p>Vous devez donc définir la <strong>description</strong> et la <strong>homepage</strong> de la formula (ex. l&rsquo;url du repository git).
Et comme il ne s&rsquo;agit pas d&rsquo;un <strong>build cmake</strong>, vous pouvez enlever les commentaires ainsi que le code lié à <strong>cmake</strong>.</p>
<p>Vous faites les premiers changements afin que l&rsquo;audit passe</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProjectTool</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>Formula</span>
  desc <span style=color:#e6db74>&#34;Installer l&#39;outil &#39;tool&#39; pour le projet&#34;</span>
  homepage <span style=color:#e6db74>&#34;https://git.client.tld/project/tool&#34;</span>
  url <span style=color:#e6db74>&#34;https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip&#34;</span>
  version <span style=color:#e6db74>&#34;1.0.0&#34;</span>
  sha256 <span style=color:#e6db74>&#34;12259beb7c5a0954f2193f581a0c11ec63ff4a573ffeb35efba4b6389d36fad7&#34;</span>

  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>install</span>
    <span style=color:#75715e># Il ne reste plus qu&#39;à faire la procédure d&#39;installation</span>
  <span style=color:#66d9ef>end</span>

  test <span style=color:#66d9ef>do</span>
    <span style=color:#75715e># Et tester la formula</span>
    system <span style=color:#e6db74>&#34;false&#34;</span>
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>Puis vous auditez et tentez d&rsquo;installer la formula</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew audit --new-formula project-tool
$ brew install project-tool
<span style=color:#f92672>==</span>&gt; Installing project-tool from utilisateur/nom_tap
<span style=color:#f92672>==</span>&gt; Downloading https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip
Already downloaded: /Users/utilisateur/Library/Caches/Homebrew/project-tool-1.0.0.zip
Error: Empty installation
</code></pre></div><p>L&rsquo;audit est bien passé, mais l&rsquo;installation de la formula vous indique que la procédure d&rsquo;installation reste à faire.</p>
<p>La procédure d&rsquo;installation manuelle vous sert de guide dans l&rsquo;écriture de votre formula</p>
<ol>
<li>Télécharger le zip,</li>
<li>Décompresser le zip,</li>
<li>Aller dans le dossier décompressé,</li>
<li>Rendre éxecutable le script <strong>bin/tool</strong>,</li>
<li>Ajouter le dossier <strong>bin</strong> au <strong>PATH</strong>,</li>
<li>Tester que <code>tool --version</code> donne bien le numéro de version de l&rsquo;outil.</li>
</ol>
<p>Homebrew téléchargera et décompressera le zip du projet automatiquement (via <strong>url</strong> et <strong>sha256</strong>) réalisant les étapes 1 et 2.</p>
<p>Pour l&rsquo;étape 3, la fonction <strong>install</strong> s&rsquo;éxecute dans le dossier décompressé.
Par contre, ce dossier est temporaire, vous devez demander à garder les dossiers <strong>bin</strong> et <strong>lib</strong> dans <strong>libexec</strong>.</p>
<p>Une <strong>formula</strong> propose plusieurs répertoires pour stocker des fichiers utiles.
Le dossier <strong>libexec</strong> sert à stocker des fichiers uniquement nécessaire à la <strong>formula</strong>.
Via <code>libexec.install</code>, vous pouvez demander qu&rsquo;un dossier y soit stocké.</p>
<p>Afin de réaliser l&rsquo;étape 4, vous devez demander à lier le script <strong>libexec/bin/tool</strong> au PATH via <code>bin.install_symlink</code>.
Cette action réalise également l&rsquo;étape 5 car <code>bin.install_symlink</code> gére aussi les permissions.</p>
<p>Le test de l&rsquo;étape 6 se fera par <code>brew test</code>, ceci une fois la fonction <strong>test</strong> remplie dans la <strong>formula</strong>.
Ce test peut simplement être que l&rsquo;éxecution de <code>tool --version</code> fonctionne.</p>
<p>De plus, une formula peut définir des pré-requis comme par exemple que Java 8 (ou plus) soit installé.
Via <code>depends_on :java => "1.8+"</code> vous définissez un tel prérequis.</p>
<p>Vous ajoutez les différentes étapes dans la formula</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProjectTool</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>Formula</span>
  desc <span style=color:#e6db74>&#34;Installer l&#39;outil &#39;tool&#39; pour le projet&#34;</span>
  homepage <span style=color:#e6db74>&#34;https://git.client.tld/project/tool&#34;</span>
  url <span style=color:#e6db74>&#34;https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip&#34;</span>
  version <span style=color:#e6db74>&#34;1.0.0&#34;</span>
  sha256 <span style=color:#e6db74>&#34;12259beb7c5a0954f2193f581a0c11ec63ff4a573ffeb35efba4b6389d36fad7&#34;</span>

  depends_on <span style=color:#e6db74>:java</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;1.8+&#34;</span>

  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>install</span>
    libexec<span style=color:#f92672>.</span>install <span style=color:#e6db74>%w[bin lib]</span>
    bin<span style=color:#f92672>.</span>install_symlink <span style=color:#66d9ef>Dir</span><span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>#{</span>libexec<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/*&#34;</span><span style=color:#f92672>]</span>
  <span style=color:#66d9ef>end</span>

  test <span style=color:#66d9ef>do</span>
    system <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>#{</span>bin<span style=color:#e6db74>}</span><span style=color:#e6db74>/tool&#34;</span>, <span style=color:#e6db74>&#34;--version&#34;</span>
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>Afin de correctement tester cette <strong>formula</strong>, vous devez</p>
<ul>
<li>l&rsquo;auditer avec <code>brew audit</code>,</li>
<li>l&rsquo;installer avec <code>brew install</code>,</li>
<li>la tester avec <code>brew test</code>.</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ brew audit --new-formula project-tool
$ brew install project-tool
<span style=color:#f92672>==</span>&gt; Installing project-tool from utilisateur/nom_tap
<span style=color:#f92672>==</span>&gt; Downloading https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip
Already downloaded: /Users/utilisateur/Library/Caches/Homebrew/project-tool-1.0.0.zip
🍺  /usr/local/Cellar/project-tool/1.0.0: <span style=color:#ae81ff>4</span> files, 100K, built in <span style=color:#ae81ff>0</span> seconds
 $ brew test project-tool
Testing utilisateur/nom_tap/project-tool
<span style=color:#f92672>==</span>&gt; Using the sandbox
<span style=color:#f92672>==</span>&gt; /usr/local/Cellar/project-tool/1.0.0/bin/tool --version
</code></pre></div><blockquote>
<p>Vous pouvez aussi vérifier le style de la formula via <code>brew style</code>.</p>
</blockquote>
<p>Comme tout s&rsquo;est bien passé, vous souhaitez maintenant la <strong>commiter</strong> pour que vos collègues puissent l&rsquo;installer plus simplement.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cd <span style=color:#66d9ef>$(</span>brew --repo utilisateur/nom_tap<span style=color:#66d9ef>)</span>
git add Formula/project-tool.rb
git commit
</code></pre></div><p>Votre collègue apprécie la nouvelle procédure</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>brew tap utilisateur/nom_tap git@git.client.tld:utilisateur/homebrew-nom_tap.git
brew install project-tool
</code></pre></div><p>NOTE: le système de <strong>formula</strong> permet également de gérer l&rsquo;installation depuis les sources (<a href=https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md#head><strong>&ndash;HEAD</strong></a>)
ou les versions bêta (<a href=https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md#devel><strong>&ndash;devel</strong></a>).
La documentation des formulas vous permettera d&rsquo;approfondir vos formulas (<a href=http://docs.brew.sh/Formula-Cookbook.html>http://docs.brew.sh/Formula-Cookbook.html</a>).</p>
<p>Maintenant que vous savez créer des <strong>formulas</strong> pour votre client,
vous pouvez aussi créer des formulas ou les maintenir sur les <strong>taps</strong> officiels.</p>
<p>Pour contribuer, la formula dans les taps officiels (comme <strong>homebrew-core</strong>) doit respecter <a href=https://github.com/Homebrew/brew/blob/master/docs/Acceptable-Formulae.md>certaines conditions pour être acceptable</a>.</p>
<p>Le projet installé par la formula doit être</p>
<ul>
<li>open-source,</li>
<li>stable, maintenu, connu, et utilisé,</li>
<li>installable depuis ces sources.</li>
</ul>
<p>Une fois la formula créée ou modifiée, vous pouvez créer une pull-request vers le project <strong>homebrew-core</strong>.
Votre pull-request sera automatiquement analysée et validée par <a href=https://bot.brew.sh/>bot.brew.sh</a>.</p>
<p>Dans le but d&rsquo;aider les mainteneurs du projet, <a href=https://bot.brew.sh/>bot.brew.sh</a> traite toutes pull-requests
en testant la formula sur les trois dernières versions supportées de macOS (<strong>yosemite, el capitan, et sierra</strong>).</p>
<p>Concernant votre projet <strong>tool</strong>, il ne vous reste plus qu&rsquo;à le rendre open-source
et proposer votre <strong>formula</strong> sur <strong>homebrew-core</strong> quand le projet sera plus connu.</p>
<p>En attendant ce jour, n&rsquo;hesitez pas à contribuer sur les formulas existantes et rejoindre les 6200 contibuteurs de <strong>homebrew-core</strong>.</p>
<p>Cet article a été publié en premier sur <a href=https://sfeir.com>lemag.sfeir.com</a>.</p>
</section>
<div class=post-tags>
<nav class="nav tags">
<ul class=tags>
<li><a href=/tags/homebrew>homebrew</a></li>
<li><a href=/tags/macos>macos</a></li>
<li><a href=/tags/french>french</a></li>
</ul>
</nav>
</div>
</article>
</main>
<footer>
<div style=display:flex><a class=soc href=https://github.com/rlespinasse rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://www.linkedin.com/in/romain-lespinasse rel=me title=LinkedIn><i data-feather=linkedin></i></a>
<a class=border></a></div>
<div class=footer-info>
2023 © Romain Lespinasse | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a>
</div>
</footer>
<script>feather.replace()</script></div>
</body>
</html>