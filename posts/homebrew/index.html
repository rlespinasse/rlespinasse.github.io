<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content=#494f5c><meta name=msapplication-TileColor content=#494f5c><meta itemprop=name content="Homebrew | Utilisez un package manager sous macOS"><meta itemprop=description content="Votre société ou votre client vient de vous confier un macbook pour travailler, il ne vous reste plus qu&rsquo;à installer tout un ensemble de programmes pour commencer.
Sous linux, vous auriez un gestionnaire de formulas qui ferait bien l&rsquo;affaire pour aller plus vite. Mais sous macOS, pas de apt-get, pas de yum, vous voilà parti pour installer tout cela à la main.
Pas de crainte, des gestionnaires de formulas existent aussi pour macOS comme Homebrew (ou MacPorts)"><meta itemprop=datePublished content=2017-02-28T10:42:00&#43;01:00><meta itemprop=dateModified content=2017-02-28T10:42:00&#43;01:00><meta itemprop=wordCount content=2632><meta itemprop=image content=https://www.romainlespinasse.dev/img/posts/homebrew/featured.jpg><meta itemprop=keywords content=homebrew,macos,french,><meta property=og:title content="Homebrew | Utilisez un package manager sous macOS"><meta property=og:description content="Votre société ou votre client vient de vous confier un macbook pour travailler, il ne vous reste plus qu&rsquo;à installer tout un ensemble de programmes pour commencer.
Sous linux, vous auriez un gestionnaire de formulas qui ferait bien l&rsquo;affaire pour aller plus vite. Mais sous macOS, pas de apt-get, pas de yum, vous voilà parti pour installer tout cela à la main.
Pas de crainte, des gestionnaires de formulas existent aussi pour macOS comme Homebrew (ou MacPorts)"><meta property=og:type content=article><meta property=og:url content=https://www.romainlespinasse.dev/posts/homebrew/><meta property=og:image content=https://www.romainlespinasse.dev/img/posts/homebrew/featured.jpg><meta property=article:published_time content=2017-02-28T10:42:00+01:00><meta property=article:modified_time content=2017-02-28T10:42:00+01:00><meta name=twitter:card content=summary_large_image><meta name=twitter:image content=https://www.romainlespinasse.dev/img/posts/homebrew/featured.jpg><meta name=twitter:title content="Homebrew | Utilisez un package manager sous macOS"><meta name=twitter:description content="Votre société ou votre client vient de vous confier un macbook pour travailler, il ne vous reste plus qu&rsquo;à installer tout un ensemble de programmes pour commencer.
Sous linux, vous auriez un gestionnaire de formulas qui ferait bien l&rsquo;affaire pour aller plus vite. Mais sous macOS, pas de apt-get, pas de yum, vous voilà parti pour installer tout cela à la main.
Pas de crainte, des gestionnaires de formulas existent aussi pour macOS comme Homebrew (ou MacPorts)"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Homebrew | Utilisez un package manager sous macOS</title><link rel=stylesheet href=https://www.romainlespinasse.dev/css/style.min.5ee5e7976cd09872c64e40a582206543f6aa38c69a8c43898aadc70040344b92.css integrity="sha256-XuXnl2zQmHLGTkClgiBlQ/aqOMaajEOJiq3HAEA0S5I=" crossorigin=anonymous><style>.bg-img{background-image:url(https://www.romainlespinasse.dev/img/posts/homebrew/featured.jpg)}</style></head><body id=page><header id=site-header class="animated slideInUp faster"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://www.romainlespinasse.dev>Romain Lespinasse</a></div><nav class="site-nav hide-in-mobile"><a href=https://www.romainlespinasse.dev/posts/>Technical posts</a>
<a href=https://www.romainlespinasse.dev/personal-projects/>Personal projects</a>
<a href=http://winter-break.romainlespinasse.dev>Is It The Winter Break Yet?</a></nav></div><div class="hdr-right hdr-icons"><button id=img-btn class=hdr-btn title="Featured Image"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg></button><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/rlespinasse target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 0 1-3.14 1.53 4.48 4.48.0 0 0-7.86 3v1A10.66 10.66.0 0 1 3 4s-4 9 5 13a11.64 11.64.0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5.0 0 0-.08-.83A7.72 7.72.0 0 0 23 3z"/></svg></a><a href=https://www.linkedin.com/in/romain-l-794143165 target=_blank rel="noopener me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><path d="M2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://github.com/rlespinasse target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0 0 20 4.77 5.07 5.07.0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38.0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 0 0 5 4.77a5.44 5.44.0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 0 0 9 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><path d="M3 12H21z"/><path d="M3 6H21z"/><path d="M3 18H21z"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://www.romainlespinasse.dev/posts/>Technical posts</a></li><li><a href=https://www.romainlespinasse.dev/personal-projects/>Personal projects</a></li><li><a href=http://winter-break.romainlespinasse.dev>Is It The Winter Break Yet?</a></li></ul></div><div class=bg-img></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Feb 28, 2017</span></div><h1>Homebrew | Utilisez un package manager sous macOS</h1></header><div class=content><p>Votre société ou votre client vient de vous confier un macbook pour travailler,
il ne vous reste plus qu&rsquo;à installer tout un ensemble de programmes pour commencer.</p><p>Sous linux, vous auriez un gestionnaire de formulas
qui ferait bien l&rsquo;affaire pour aller plus vite.
Mais sous macOS, pas de apt-get, pas de yum,
vous voilà parti pour installer tout cela à la main.</p><p>Pas de crainte, des gestionnaires de formulas existent aussi pour macOS comme <a href=http://brew.sh/ rel="nofollow noreferrer" target=_blank><strong>Homebrew</strong></a> (ou <a href=https://www.macports.org rel="nofollow noreferrer" target=_blank>MacPorts</a>)</p><p>Installer homebrew en une ligne de commande</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>/usr/bin/ruby -e <span class=s2>&#34;</span><span class=k>$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class=k>)</span><span class=s2>&#34;</span></code></pre></div><blockquote><p><strong>Homebrew</strong> est un gestionnaire basé sur des <strong>formulas</strong> d&rsquo;installation de formula (en <strong>Ruby</strong>)
et utilise des <strong>repositories git</strong> comme conteneurs de ces <strong>formulas</strong>.</p></blockquote><p>Après une simple installation, vous avez à votre disposition une nouvelle commande,
petit tour du proprietaire :</p><p>La commande <strong>&ldquo;brew&rdquo;</strong> vous montre les commandes les plus courantes.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew
Example usage:
  brew search <span class=o>[</span>TEXT<span class=p>|</span>/REGEX/<span class=o>]</span>
  brew <span class=o>(</span>info<span class=p>|</span>home<span class=p>|</span>options<span class=o>)</span> <span class=o>[</span>FORMULA...<span class=o>]</span>
  brew install FORMULA...
  brew update
  brew upgrade <span class=o>[</span>FORMULA...<span class=o>]</span>
  brew uninstall FORMULA...
  brew list <span class=o>[</span>FORMULA...<span class=o>]</span>

Troubleshooting:
  brew config
  brew doctor
  brew install -vd FORMULA</code></pre></div><p>Dans ces commandes, on retourne notamment celles pour gérer le <strong>cycle de vie de votre formula</strong></p><p>brew install FORMULA&hellip;
brew update
brew upgrade [FORMULA&hellip;]
brew uninstall FORMULA&hellip;</p><p>TIP: En executant <code>brew doctor</code>, vous vérifiez que votre installation de Homebrew est correcte.
La commande vous indiquera les différents problèmes de votre installation (s&rsquo;il y en a).</p><p>Maintenant que homebrew est installé, vous souhaitez installer vos premiers formulas.</p><p>Vous commencez par vos besoins pour le projet.
Comme il s&rsquo;agit d&rsquo;un projet en <strong>Java</strong> sous <strong>Gradle</strong> avec des outils écrits en <strong>Go</strong>
et que l&rsquo;ensemble est géré par Ansible, vous avez votre liste de formulas:</p><ul><li>Ansible</li><li>Java</li><li>Go</li><li>Gradle</li></ul><p>Vous installez vos formulas hors java</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew install ansible go gradle

$ ansible --version
ansible <span class=m>2</span>.2.0.0

$ go version
go version go1.7.4 darwin/amd64

$ gradle -v
Gradle <span class=m>3</span>.3</code></pre></div><p>Vous installer java à part, car vous souhaitez installer java 8.</p><p>Vous rechercher donc les <strong>formulas</strong> nommées <strong>java</strong></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew search java
app-engine-java
google-java-format
javarepl
jslint4java
libreadline-java
homebrew/emacs/javaimp
Caskroom/cask/eclipse-java
Caskroom/cask/java
Caskroom/cask/netbeans-java-ee
Caskroom/cask/netbeans-java-se
Caskroom/cask/yourkit-java-profiler
Caskroom/versions/charles-applejava
Caskroom/versions/charles-beta-applejava
Caskroom/versions/java-beta
Caskroom/versions/java6
Caskroom/versions/java7
Caskroom/versions/java9-beta</code></pre></div><p><strong>Aie</strong>, il n&rsquo;y a pas de <strong>formula</strong> nommée <strong>java</strong> ou <strong>java8</strong>.
Par contre la recherche vous propose les formulas contenant le mot <strong>java</strong>.
Parmis les formulas, ceux avec un chemin (<strong>a/b/formula</strong>) sont des formulas contenues dans des <strong>taps</strong>.</p><p><strong>Mais qu&rsquo;est-ce qu&rsquo;un tap</strong>, il s&rsquo;agit d&rsquo;un autre <strong>repository git</strong>
contenant des formulas dédiées ou des nouvelles commandes.</p><blockquote><p>On installe un <strong>tap</strong> via la commande <code>brew tap utilisateur/nom_tap</code>.</p><p>Avec le tap <strong>utilisateur/nom_tap</strong>, brew installera le <strong>repository git</strong> associé à l&rsquo;url <a href=https://github.com/utilisateur/homebrew-nom_tap rel="nofollow noreferrer" target=_blank>https://github.com/utilisateur/homebrew-nom_tap</a>.</p><p>Pour les autres possibilités, utilisez <code>brew tap -h</code>.</p></blockquote><p>TIP: <code>brew install a/b/formula</code> installera le <strong>tap</strong> et la formula en même temps.</p><p>Parmis les <strong>taps</strong> officiels, on peut trouver :</p><ul><li><a href=https://github.com/Homebrew/homebrew-core rel="nofollow noreferrer" target=_blank><strong>homebrew/core</strong></a> - <strong>Core formulae for the Homebrew formula manager</strong> <strong>(the default tap)</strong></li><li><a href=https://github.com/Homebrew/homebrew-science rel="nofollow noreferrer" target=_blank><strong>homebrew/science</strong></a> - <strong>Scientific formulae for the Homebrew formula manager</strong></li><li><a href=https://github.com/Homebrew/homebrew-games rel="nofollow noreferrer" target=_blank><strong>homebrew/games</strong></a> - <strong>Games formulae for the Homebrew formula manager</strong></li><li><a href=https://github.com/Homebrew/homebrew-completions rel="nofollow noreferrer" target=_blank><strong>homebrew/completions</strong></a> - <strong>Shell completion formulae for the Homebrew formula manager</strong></li><li><a href=https://github.com/Homebrew/homebrew-command-not-found rel="nofollow noreferrer" target=_blank><strong>homebrew/command-not-found</strong></a> - <strong>Ubuntu’s command-not-found equivalent for Homebrew on OSX</strong></li><li><a href=https://github.com/Homebrew/homebrew-services rel="nofollow noreferrer" target=_blank><strong>homebrew/services</strong></a> - <strong>Starts Homebrew formulae&rsquo;s plists with launchctl</strong></li></ul><p>Tous ces <strong>taps</strong> sont gérés par la communauté Homebrew,
mais certains <strong>taps</strong> officiels ne sont pas de Homebrew mais sont bien intégrés comme <strong>Caskroom/cask</strong>.</p><p>Les <strong>formulas</strong> de <strong>Caskroom/cask</strong> sont dédiés aux installations d&rsquo;applications macOS</p><p>Maintenant, vous installez <strong>java 8</strong></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew install Caskroom/cask/java
<span class=o>==</span>&gt; brew cask install Caskroom/cask/java
...

$ java -version
java version <span class=s2>&#34;1.8.0_112&#34;</span>
Java<span class=o>(</span>TM<span class=o>)</span> SE Runtime Environment <span class=o>(</span>build <span class=m>1</span>.8.0_112-b16<span class=o>)</span>
Java HotSpot<span class=o>(</span>TM<span class=o>)</span> <span class=m>64</span>-Bit Server VM <span class=o>(</span>build <span class=m>25</span>.112-b16, mixed mode<span class=o>)</span></code></pre></div><p>Lors du lancement de la commande, brew a transféré votre demande à <code>brew cask install</code> pour son installation.</p><p>Avec <strong>Cask</strong>, vous pouvez, en plus de vos formulas, installer votre navigateur, votre éditeur de code,&hellip;</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>brew cask install google-chrome intellij-idea docker slack</code></pre></div><p>TIP: <code>brew tap caskroom/drivers</code> vous permet d&rsquo;installer les drivers pour macOS.
Les fonts s&rsquo;installent elles via <code>brew tap caskroom/fonts</code>.</p><p>Certains formulas sont gérées comme des <strong>services</strong> via macOS <strong>launchd</strong>.
Pour cela, brew propose, via <a href=https://github.com/Homebrew/homebrew-services rel="nofollow noreferrer" target=_blank><strong>homebrew/services</strong></a>,
la commande <strong>brew services</strong> pour faciliter leurs utilisations.</p><p>Pour votre projet, vous avez aussi besoin d&rsquo;une base de données <strong>MySQL</strong>.</p><p>Vous installez <strong>MySQL</strong> qui possède un service sous macOS</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew install mysql

$ brew services list
Name           Status  User Plist
mysql          stopped

$ brew services start <span class=nv>mysql</span>
<span class=o>==</span>&gt; Successfully started <span class=sb>`</span>mysql<span class=sb>`</span> <span class=o>(</span>label: homebrew.mxcl.mysql<span class=o>)</span>

$ brew services list
Name           Status  User            Plist
mysql          started &lt;your_username&gt; ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist</code></pre></div><p>Votre installation de poste est terminée. Vous pouvez commencer à travailler.</p><p>Au bout d&rsquo;un certain temps, vous souhaiteriez mettre à jour vos formulas.</p><p>La procédure de mise à jour se fait en deux commandes <strong>update</strong> + <strong>upgrade</strong>.
Avec ces 2 commandes, vous pouvez aussi utiliser deux autres commandes <strong>outdated</strong> et <strong>cleanup</strong> utiles suivant vos besoins.</p><ul><li><p><strong>update</strong> met à jour les <strong>repositories git</strong> des <strong>taps</strong>,</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew update
Updated <span class=m>2</span> taps <span class=o>(</span>caskroom/cask, homebrew/core<span class=o>)</span>.
<span class=o>==</span>&gt; New <span class=nv>Formulae</span>
<span class=o>==</span>&gt; Updated Formulae
go ✔</code></pre></div></li><li><p><strong>upgrade</strong> met à jour les formulas,</p><pre><code>$ brew upgrade
==&gt; Upgrading 1 outdated formula, with result:
go 1.7.4_1
==&gt; Upgrading go
==&gt; Downloading https://homebrew.bintray.com/bottles/go-1.7.4_1.sierra.bottle.tar.gz
...
🍺  /usr/local/Cellar/go/1.7.4_1: 6,438 files, 250.7M
</code></pre></li><li><p><strong>outdated</strong> liste les formulas qui doivent être mis à jour,</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew outdated
go <span class=o>(</span><span class=m>1</span>.6<span class=o>)</span> &lt; <span class=m>1</span>.7.4_1</code></pre></div></li><li><p><strong>cleanup</strong> supprime les anciennes versions des formulas (car Homebrew les garde indéfiniment).</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew cleanup
Removing: /usr/local/Cellar/go/1.6... <span class=o>(</span><span class=m>6</span>,438 files, <span class=m>250</span>.7M<span class=o>)</span>
<span class=o>==</span>&gt; This operation has freed approximately <span class=m>250</span>.7M of disk space.</code></pre></div></li></ul><blockquote><p>Définissez un alias <strong>bubu</strong> (déjà disponible par défaut dans <strong>zsh</strong>) pour <code>brew update &amp;&amp; brew outdated &amp;&amp; brew upgrade &amp;&amp; brew cleanup</code>, et ainsi en une commande gèrer vos formulas plus simplement.</p></blockquote><p>Vous venez d&rsquo;apprendre qu&rsquo;un des mécanismes par défaut de Homebrew
est de conserver toutes les versions installées de vos formulas.
Ceci dans le but de vous permettre de facilement switcher entre ces versions.</p><blockquote><p><strong>brew install &lt;formula&gt;</strong> ne permet d&rsquo;installer que la version courante du formula, jamais une ancienne version.</p></blockquote><p>Par exemple comment passer à une version go 1.6 puis revenir sur une version go 1.7</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew switch go <span class=m>1</span>.6
Cleaning /usr/local/Cellar/go/1.6
Cleaning /usr/local/Cellar/go/1.7.4_1
<span class=m>3</span> links created <span class=k>for</span> /usr/local/Cellar/go/1.6

$ brew switch go <span class=m>1</span>.7.4_1
Cleaning /usr/local/Cellar/go/1.6
Cleaning /usr/local/Cellar/go/1.7.4_1
<span class=m>3</span> links created <span class=k>for</span> /usr/local/Cellar/go/1.7.4_1</code></pre></div><p>TIP: Le tap <strong>homebrew/versions</strong> vous permet d&rsquo;accèder à d&rsquo;anciennes versions.</p><p>Sur le projet, votre voisin de bureau commence sa première journée
et vous demande de lui passer votre liste de formulas et d&rsquo;applications
pour faire lui aussi l&rsquo;installation rapidement.</p><p>Vous appliquez la méthode KISS</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>brew list &gt; brew-formulas.txt
brew cask list &gt; brew-applications.txt</code></pre></div><p>Et votre voisin devrait se débrouiller avec les deux fichers bruts que vous venez de lui envoyer par email.
C&rsquo;est KISS mais seulement pour vous.</p><p>Mais là encore, Homebrew a pensé à faciliter ce genre d&rsquo;actions via <strong>brew bundle</strong>.</p><p>Vous créez un Brewfile de votre poste via <code>brew bundle dump</code></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew bundle dump
$ cat Brewfile
tap <span class=s1>&#39;caskroom/cask&#39;</span>
tap <span class=s1>&#39;homebrew/bundle&#39;</span>
tap <span class=s1>&#39;homebrew/core&#39;</span>
tap <span class=s1>&#39;homebrew/services&#39;</span>
brew <span class=s1>&#39;ansible&#39;</span>
brew <span class=s1>&#39;go&#39;</span>
brew <span class=s1>&#39;mysql&#39;</span>, restart_service: <span class=nb>true</span>
brew <span class=s1>&#39;gradle&#39;</span>
cask <span class=s1>&#39;docker&#39;</span>
cask <span class=s1>&#39;google-chrome&#39;</span>
cask <span class=s1>&#39;intellij-idea&#39;</span>
cask <span class=s1>&#39;java&#39;</span>
cask <span class=s1>&#39;slack&#39;</span></code></pre></div><p>Un fichier <strong>Brewfile</strong> commence par lister les <strong>taps</strong> installés, puis les formulas installés, ainsi que les applications.
Il garde même en mémoire les status des services (ici, <strong>mysql</strong> est lancé).</p><p>Vous transmettez le fichier <strong>Brewfile</strong> à votre voisin et il n&rsquo;a plus qu&rsquo;à l&rsquo;utiliser.</p><p>Votre voisin de bureau installe ce Brewfile sur son poste</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew bundle
Tapping caskroom/cask
Tapping homebrew/bundle
Using homebrew/core
Tapping homebrew/services
Installing ansible
Installing go
Installing gradle
Installing mysql
Installing docker
Installing google-chrome
Installing intellij-idea
Installing java
Installing slack</code></pre></div><p>TIP: Par défaut, <strong>brew bundle</strong> utilise le fichier <strong>Brewfile</strong> depuis le dossier courant.
L&rsquo;option <code>--file=path</code> permet de définir un autre chemin vers le fichier <strong>Brewfile</strong>.
L&rsquo;option <code>--global</code> ira lire un fichier <strong>.Brefile</strong> depuis votre <strong>$HOME</strong>.</p><p>Après la découverte de <strong>brew bundle</strong>,
vous vous dites autant partager la liste des formulas nécessaire pour un projet spécifiquement.</p><p>Pour cela, il suffit de créer un fichier <strong>Brewfile</strong> dans vos sources de projet et de le commiter.
Comme cela un nouveau développeur n&rsquo;a qu&rsquo;à lancer <code>brew bundle</code> pour être sûr d&rsquo;avoir le nécessaire pour travailler sur le projet.</p><p>Cela tombe bien, vous avez un nouveau projet en Java sous Gradle à faire et qui servira comme outil aux autres développeurs.</p><p>Vous créez un <strong>Brewfile</strong> dans votre nouveau projet avec Java et Gradle</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ <span class=nb>cd</span> project-tool
$ vim Brewfile
$ cat Brewfile
tap <span class=s1>&#39;caskroom/cask&#39;</span>
brew <span class=s1>&#39;gradle&#39;</span>
cask <span class=s1>&#39;java&#39;</span></code></pre></div><p>Après que ce nouveau projet soit prêt, il est temps que les autres développeurs l&rsquo;utilisent.
Pour faciliter sa distribution, vous l&rsquo;avez publié dans votre repository manager de votre client (ex. <strong>Nexus</strong>).</p><p>Un de vos collègues teste l&rsquo;installation du nouvel outil</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ <span class=nv>tool_url</span><span class=o>=</span><span class=s1>&#39;https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip&#39;</span>
$ wget <span class=nv>$tool_url</span>
$ unzip tool-1.0.0-distribution.zip
$ tree
tool-1.0.0-distribution
├── bin
│   └── tool
└── lib
    └── tool-1.0.0.jar
$ chmod u+x tool-1.0.0-distribution/bin/tool
$ <span class=nb>echo</span> <span class=s2>&#34;export PATH=\&#34;</span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span><span class=s2>/tool-1.0.0-distribution/bin:\$PATH\&#34;&#34;</span> &gt;&gt; ~/.bashrc
$ . ~/.bashrc
$ tool --version
<span class=m>1</span>.0.0</code></pre></div><p>Mais la procédure d&rsquo;installation n&rsquo;est pas aussi simple que d&rsquo;écrire <code>brew install project-tool</code>.
Pourquoi ne pas créer une <strong>formula</strong> aussi pour ce projet?</p><p>Avant de la créer, vous vous demandez comment la sauvegarder?
Homebrew vous propose déjà des <strong>taps</strong> pour avoir plus de <strong>formulas</strong> disponibles.</p><p>Vous pouvez créer un <strong>tap</strong> privé qui est un simple repository git.
Par défaut, un <strong>tap</strong> ajouté via <code>brew tap utilisateur/nom_tap</code> corresponds à l&rsquo;url <a href=https://github.com/utilisateur/homebrew-nom_tap.git rel="nofollow noreferrer" target=_blank>https://github.com/utilisateur/homebrew-nom_tap.git</a></p><p>Si vous voulez le stocker ailleurs, l&rsquo;ajout se fait par <code>brew tap utilisateur/nom_tap git@git.client.tld:utilisateur/homebrew-nom_tap.git</code>.</p><p>NOTE: Dans un <strong>Brewfile</strong>, ajouter la ligne <code>tap 'utilisateur/nom_tap', 'git@git.client.tld:utilisateur/homebrew-nom_tap.git'</code> pour déclarer ce tap.</p><p>Une fois que vous avez créé et ajouté ce <strong>tap</strong> privé, vous pouvez passer à la création de la <strong>formula</strong> via la commande <code>create</code>.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew create <span class=nv>$tool_url</span> --set-name project-tool --set-version <span class=m>1</span>.0.0 --tap utilisateur/nom_tap
<span class=o>==</span>&gt; Downloading https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip
<span class=c1>######################################################################## 100,0%</span>
Please <span class=sb>`</span>brew audit --new-formula project-tool<span class=sb>`</span> before submitting, thanks.
Editing /usr/local/Homebrew/Library/Taps/utilisateur/nom_tap/project-tool.rb</code></pre></div><p>Suite à la création de votre <strong>formula</strong>, homebrew ouvre automatiquement le fichier associé.</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=c1># Documentation: http://docs.brew.sh/Formula-Cookbook.html # &lt;1&gt;</span>
<span class=c1>#                http://www.rubydoc.info/github/Homebrew/brew/master/Formula</span>
<span class=c1># PLEASE REMOVE ALL GENERATED COMMENTS BEFORE SUBMITTING YOUR PULL REQUEST!</span>

<span class=k>class</span> <span class=nc>ProjectTool</span> <span class=o>&lt;</span> <span class=no>Formula</span>
  <span class=n>desc</span> <span class=s2>&#34;&#34;</span>
  <span class=n>homepage</span> <span class=s2>&#34;&#34;</span>
  <span class=n>url</span> <span class=s2>&#34;https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip&#34;</span> <span class=c1># &lt;2&gt;</span>
  <span class=n>version</span> <span class=s2>&#34;1.0.0&#34;</span>
  <span class=n>sha256</span> <span class=s2>&#34;12259beb7c5a0954f2193f581a0c11ec63ff4a573ffeb35efba4b6389d36fad7&#34;</span>

  <span class=c1># depends_on &#34;cmake&#34; =&gt; :build # &lt;3&gt;</span>

  <span class=k>def</span> <span class=nf>install</span>
    <span class=c1># ENV.deparallelize  # if your formula fails when building in parallel</span>

    <span class=c1># Remove unrecognized options if warned by configure</span>
    <span class=nb>system</span> <span class=s2>&#34;./configure&#34;</span><span class=p>,</span> <span class=s2>&#34;--disable-debug&#34;</span><span class=p>,</span>
                          <span class=s2>&#34;--disable-dependency-tracking&#34;</span><span class=p>,</span>
                          <span class=s2>&#34;--disable-silent-rules&#34;</span><span class=p>,</span>
                          <span class=s2>&#34;--prefix=</span><span class=si>#{</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&#34;</span>
    <span class=c1># system &#34;cmake&#34;, &#34;.&#34;, *std_cmake_args</span>
    <span class=nb>system</span> <span class=s2>&#34;make&#34;</span><span class=p>,</span> <span class=s2>&#34;install&#34;</span> <span class=c1># if this fails, try separate make/make install steps</span>
  <span class=k>end</span>

  <span class=nb>test</span> <span class=k>do</span>
    <span class=c1># `test do` will create, run in and delete a temporary directory.</span>
    <span class=c1>#</span>
    <span class=c1># This test will fail and we won&#39;t accept that! It&#39;s enough to just replace</span>
    <span class=c1># &#34;false&#34; with the main program this formula installs, but it&#39;d be nice if you</span>
    <span class=c1># were more thorough. Run the test with `brew test project-tool`. Options passed</span>
    <span class=c1># to `brew install` such as `--HEAD` also need to be provided to `brew test`.</span>
    <span class=c1>#</span>
    <span class=c1># The installed folder is not in the path, so use the entire path to any</span>
    <span class=c1># executables being tested: `system &#34;#{bin}/program&#34;, &#34;do&#34;, &#34;something&#34;`.</span>
    <span class=nb>system</span> <span class=s2>&#34;false&#34;</span>
  <span class=k>end</span>
<span class=k>end</span></code></pre></div><blockquote><ol><li>La formula vous fournie le lien vers la documentation pour finir sa création,</li><li>La formula contient déjà les informations données (ex. url, version) ou générées (ex. sha256),</li><li>Le reste du code est un template par défaut.</li></ol></blockquote><p>Vous pouvez <strong>auditer</strong> la formula pour savoir par où commencer</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew audit --new-formula project-tool
utilisateur/nom_tap/project-tool:
  * Formula should have a desc <span class=o>(</span>Description<span class=o>)</span>.
  * The homepage should start with http or https <span class=o>(</span>URL is <span class=o>)</span>.
  * The homepage  is not reachable <span class=o>(</span>HTTP status code <span class=m>000</span><span class=o>)</span>
  * Please remove default template comments
  * Please remove default template comments
  * Commented-out dep <span class=s2>&#34;cmake&#34;</span> <span class=o>=</span>&gt; :build
  * Please remove default template comments
  * Please remove default template comments
  * Commented cmake call found
  * Please remove default template comments
Error: <span class=m>10</span> problems in <span class=m>1</span> formula</code></pre></div><p>Vous devez donc définir la <strong>description</strong> et la <strong>homepage</strong> de la formula (ex. l&rsquo;url du repository git).
Et comme il ne s&rsquo;agit pas d&rsquo;un <strong>build cmake</strong>, vous pouvez enlever les commentaires ainsi que le code lié à <strong>cmake</strong>.</p><p>Vous faites les premiers changements afin que l&rsquo;audit passe</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=k>class</span> <span class=nc>ProjectTool</span> <span class=o>&lt;</span> <span class=no>Formula</span>
  <span class=n>desc</span> <span class=s2>&#34;Installer l&#39;outil &#39;tool&#39; pour le projet&#34;</span>
  <span class=n>homepage</span> <span class=s2>&#34;https://git.client.tld/project/tool&#34;</span>
  <span class=n>url</span> <span class=s2>&#34;https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip&#34;</span>
  <span class=n>version</span> <span class=s2>&#34;1.0.0&#34;</span>
  <span class=n>sha256</span> <span class=s2>&#34;12259beb7c5a0954f2193f581a0c11ec63ff4a573ffeb35efba4b6389d36fad7&#34;</span>

  <span class=k>def</span> <span class=nf>install</span>
    <span class=c1># Il ne reste plus qu&#39;à faire la procédure d&#39;installation</span>
  <span class=k>end</span>

  <span class=nb>test</span> <span class=k>do</span>
    <span class=c1># Et tester la formula</span>
    <span class=nb>system</span> <span class=s2>&#34;false&#34;</span>
  <span class=k>end</span>
<span class=k>end</span></code></pre></div><p>Puis vous auditez et tentez d&rsquo;installer la formula</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew audit --new-formula project-tool
$ brew install project-tool
<span class=o>==</span>&gt; Installing project-tool from utilisateur/nom_tap
<span class=o>==</span>&gt; Downloading https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip
Already downloaded: /Users/utilisateur/Library/Caches/Homebrew/project-tool-1.0.0.zip
Error: Empty installation</code></pre></div><p>L&rsquo;audit est bien passé, mais l&rsquo;installation de la formula vous indique que la procédure d&rsquo;installation reste à faire.</p><p>La procédure d&rsquo;installation manuelle vous sert de guide dans l&rsquo;écriture de votre formula</p><ol><li>Télécharger le zip,</li><li>Décompresser le zip,</li><li>Aller dans le dossier décompressé,</li><li>Rendre éxecutable le script <strong>bin/tool</strong>,</li><li>Ajouter le dossier <strong>bin</strong> au <strong>PATH</strong>,</li><li>Tester que <code>tool --version</code> donne bien le numéro de version de l&rsquo;outil.</li></ol><p>Homebrew téléchargera et décompressera le zip du projet automatiquement (via <strong>url</strong> et <strong>sha256</strong>) réalisant les étapes 1 et 2.</p><p>Pour l&rsquo;étape 3, la fonction <strong>install</strong> s&rsquo;éxecute dans le dossier décompressé.
Par contre, ce dossier est temporaire, vous devez demander à garder les dossiers <strong>bin</strong> et <strong>lib</strong> dans <strong>libexec</strong>.</p><p>Une <strong>formula</strong> propose plusieurs répertoires pour stocker des fichiers utiles.
Le dossier <strong>libexec</strong> sert à stocker des fichiers uniquement nécessaire à la <strong>formula</strong>.
Via <code>libexec.install</code>, vous pouvez demander qu&rsquo;un dossier y soit stocké.</p><p>Afin de réaliser l&rsquo;étape 4, vous devez demander à lier le script <strong>libexec/bin/tool</strong> au PATH via <code>bin.install_symlink</code>.
Cette action réalise également l&rsquo;étape 5 car <code>bin.install_symlink</code> gére aussi les permissions.</p><p>Le test de l&rsquo;étape 6 se fera par <code>brew test</code>, ceci une fois la fonction <strong>test</strong> remplie dans la <strong>formula</strong>.
Ce test peut simplement être que l&rsquo;éxecution de <code>tool --version</code> fonctionne.</p><p>De plus, une formula peut définir des pré-requis comme par exemple que Java 8 (ou plus) soit installé.
Via <code>depends_on :java =&gt; &quot;1.8+&quot;</code> vous définissez un tel prérequis.</p><p>Vous ajoutez les différentes étapes dans la formula</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=k>class</span> <span class=nc>ProjectTool</span> <span class=o>&lt;</span> <span class=no>Formula</span>
  <span class=n>desc</span> <span class=s2>&#34;Installer l&#39;outil &#39;tool&#39; pour le projet&#34;</span>
  <span class=n>homepage</span> <span class=s2>&#34;https://git.client.tld/project/tool&#34;</span>
  <span class=n>url</span> <span class=s2>&#34;https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip&#34;</span>
  <span class=n>version</span> <span class=s2>&#34;1.0.0&#34;</span>
  <span class=n>sha256</span> <span class=s2>&#34;12259beb7c5a0954f2193f581a0c11ec63ff4a573ffeb35efba4b6389d36fad7&#34;</span>

  <span class=n>depends_on</span> <span class=ss>:java</span> <span class=o>=&gt;</span> <span class=s2>&#34;1.8+&#34;</span>

  <span class=k>def</span> <span class=nf>install</span>
    <span class=n>libexec</span><span class=o>.</span><span class=n>install</span> <span class=sx>%w[bin lib]</span>
    <span class=n>bin</span><span class=o>.</span><span class=n>install_symlink</span> <span class=no>Dir</span><span class=o>[</span><span class=s2>&#34;</span><span class=si>#{</span><span class=n>libexec</span><span class=si>}</span><span class=s2>/bin/*&#34;</span><span class=o>]</span>
  <span class=k>end</span>

  <span class=nb>test</span> <span class=k>do</span>
    <span class=nb>system</span> <span class=s2>&#34;</span><span class=si>#{</span><span class=n>bin</span><span class=si>}</span><span class=s2>/tool&#34;</span><span class=p>,</span> <span class=s2>&#34;--version&#34;</span>
  <span class=k>end</span>
<span class=k>end</span></code></pre></div><p>Afin de correctement tester cette <strong>formula</strong>, vous devez</p><ul><li>l&rsquo;auditer avec <code>brew audit</code>,</li><li>l&rsquo;installer avec <code>brew install</code>,</li><li><p>la tester avec <code>brew test</code>.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ brew audit --new-formula project-tool
$ brew install project-tool
<span class=o>==</span>&gt; Installing project-tool from utilisateur/nom_tap
<span class=o>==</span>&gt; Downloading https://nexus.client.tld/content/repositories/releases/tld/client/project/tool/1.0.0/tool-1.0.0-distribution.zip
Already downloaded: /Users/utilisateur/Library/Caches/Homebrew/project-tool-1.0.0.zip
🍺  /usr/local/Cellar/project-tool/1.0.0: <span class=m>4</span> files, 100K, built in <span class=m>0</span> seconds
$ brew <span class=nb>test</span> project-tool
Testing utilisateur/nom_tap/project-tool
<span class=o>==</span>&gt; Using the <span class=nv>sandbox</span>
<span class=o>==</span>&gt; /usr/local/Cellar/project-tool/1.0.0/bin/tool --version</code></pre></div></li></ul><blockquote><p>Vous pouvez aussi vérifier le style de la formula via <code>brew style</code>.</p></blockquote><p>Comme tout s&rsquo;est bien passé, vous souhaitez maintenant la <strong>commiter</strong> pour que vos collègues puissent l&rsquo;installer plus simplement.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=nb>cd</span> <span class=k>$(</span>brew --repo utilisateur/nom_tap<span class=k>)</span>
git add Formula/project-tool.rb
git commit</code></pre></div><p>Votre collègue apprécie la nouvelle procédure</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>brew tap utilisateur/nom_tap git@git.client.tld:utilisateur/homebrew-nom_tap.git
brew install project-tool</code></pre></div><p>NOTE: le système de <strong>formula</strong> permet également de gérer l&rsquo;installation depuis les sources (<a href=https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md#head rel="nofollow noreferrer" target=_blank><strong>&ndash;HEAD</strong></a>)
ou les versions bêta (<a href=https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md#devel rel="nofollow noreferrer" target=_blank><strong>&ndash;devel</strong></a>).
La documentation des formulas vous permettera d&rsquo;approfondir vos formulas (<a href=http://docs.brew.sh/Formula-Cookbook.html rel="nofollow noreferrer" target=_blank>http://docs.brew.sh/Formula-Cookbook.html</a>).</p><p>Maintenant que vous savez créer des <strong>formulas</strong> pour votre client,
vous pouvez aussi créer des formulas ou les maintenir sur les <strong>taps</strong> officiels.</p><p>Pour contribuer, la formula dans les taps officiels (comme <strong>homebrew-core</strong>) doit respecter <a href=https://github.com/Homebrew/brew/blob/master/docs/Acceptable-Formulae.md rel="nofollow noreferrer" target=_blank>certaines conditions pour être acceptable</a>.</p><p>Le projet installé par la formula doit être</p><ul><li>open-source,</li><li>stable, maintenu, connu, et utilisé,</li><li>installable depuis ces sources.</li></ul><p>Une fois la formula créée ou modifiée, vous pouvez créer une pull-request vers le project <strong>homebrew-core</strong>.
Votre pull-request sera automatiquement analysée et validée par <a href=https://bot.brew.sh/ rel="nofollow noreferrer" target=_blank>bot.brew.sh</a>.</p><p>Dans le but d&rsquo;aider les mainteneurs du projet, <a href=https://bot.brew.sh/ rel="nofollow noreferrer" target=_blank>bot.brew.sh</a> traite toutes pull-requests
en testant la formula sur les trois dernières versions supportées de macOS (<strong>yosemite, el capitan, et sierra</strong>).</p><p>Concernant votre projet <strong>tool</strong>, il ne vous reste plus qu&rsquo;à le rendre open-source
et proposer votre <strong>formula</strong> sur <strong>homebrew-core</strong> quand le projet sera plus connu.</p><p>En attendant ce jour, n&rsquo;hesitez pas à contribuer sur les formulas existantes et rejoindre les 6200 contibuteurs de <strong>homebrew-core</strong>.</p><p>Cet article a été publié en premier sur <a href=https://sfeir.com rel="nofollow noreferrer" target=_blank>lemag.sfeir.com</a>.</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83.0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><path d="M7 7V7z"/></svg><span class=tag><a href=https://www.romainlespinasse.dev/tags/homebrew>homebrew</a></span><span class=tag><a href=https://www.romainlespinasse.dev/tags/macos>macos</a></span><span class=tag><a href=https://www.romainlespinasse.dev/tags/french>french</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2V8h6"/><path d="M16 13H8z"/><path d="M16 17H8z"/><path d="M10 9H9 8"/></svg>2632 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><path d="M16 2V6z"/><path d="M8 2V6z"/><path d="M3 10H21z"/></svg>2017-02-28 09:42 &#43;0000</p></footer></article><div class="post-nav thin"><a class=next-post href=https://www.romainlespinasse.dev/posts/antora/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><path d="M19 12H5z"/><path d="M12 19 5 12l7-7"/></svg>&nbsp;Newer</span><br><span>Antora | Remplacer votre wiki par un site de documentation</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2019 <a href=https://www.romainlespinasse.dev>Romain Lespinasse</a> &#183; <a href=https://tldrlegal.com/license/mit-license target=_blank rel=noopener>MIT License</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://www.romainlespinasse.dev/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://www.romainlespinasse.dev/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-150515783-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>